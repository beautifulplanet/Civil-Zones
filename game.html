<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Zones v48.0 - Stone Age Civilization</title>
    <style>
        :root {
            --bg: #0A0806; --text: #F5E6C8; --panel: #2E251B; --border: #5C4A3D;
            --c-res: #4fc3f7; --c-com: #ffd54f; --c-ind: #ff7043; --c-wat: #00e5ff; --c-road: #8d6e63; --c-bull: #e57373;
            --accent: #8B6914; --accent-hover: #A68328; --text-primary: #F5E6C8; --text-secondary: #C4A878; --text-muted: #8B7355;
            --tribal-gold: #8B6914; --tribal-brown: #5C4A3D; --tribal-dark: #2E251B; --tribal-leather: #6B4423;
        }
        html, body { margin: 0; width: 100%; height: 100%; background: #0a0a0f; color: var(--text); font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow: hidden; display: flex; flex-direction: column; user-select: none; }
        
        /* Loading screen */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a1a2a 0%, #2d2d44 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; color: #F5E6C8;
        }
        #loading-screen h1 { font-size: 48px; margin-bottom: 20px; color: #D4A040; }
        #loading-screen .spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(212, 160, 64, 0.3);
            border-top-color: #D4A040; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        #loading-screen .status { margin-top: 20px; font-size: 14px; color: #A89070; }
        @keyframes spin { to { transform: rotate(360deg); } }
        body.game-ready #loading-screen { display: none !important; }
        
        /* Menubar */
        #menubar { 
            height: 56px; 
            background: linear-gradient(180deg, rgba(60, 45, 30, 0.98) 0%, rgba(46, 37, 27, 0.98) 50%, rgba(35, 28, 20, 0.98) 100%);
            display: flex; align-items: center; padding: 0 12px; gap: 6px; 
            border-bottom: 3px solid #8B6914; z-index: 100; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.7), 0 2px 8px rgba(139, 105, 20, 0.2), inset 0 -2px 4px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.03);
            flex-wrap: nowrap; overflow-x: auto;
        }
        #menubar .btn { padding: 6px 10px; font-size: 14px; min-width: 36px; flex-shrink: 0; }
        #menubar .separator, .separator { width: 1px; height: 28px; background: rgba(139, 105, 20, 0.5); flex-shrink: 0; }
        .menubar-right { display: flex; align-items: center; gap: 4px; margin-left: auto; flex-shrink: 0; }
        .menubar-right .btn { padding: 4px 8px !important; font-size: 12px !important; }
        .debug-btn { padding: 2px 5px !important; font-size: 9px !important; opacity: 0.7; }
        .debug-btn:hover { opacity: 1; }
        
        /* Viewport */
        #viewport { flex: 1 1 auto; background: #1a1512; position: relative; overflow: hidden; display: flex; min-height: 200px; }
        #canvas-container { flex: 1 1 auto; position: relative; background: #1a1512; width: 100%; height: 100%; }
        #game-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #1a1512; }
        
        /* Dashboard */
        #dashboard { 
            height: auto; min-height: 60px;
            background: linear-gradient(180deg, rgba(46, 37, 27, 0.98) 0%, rgba(35, 28, 20, 0.98) 50%, rgba(25, 20, 15, 0.98) 100%);
            border-top: 3px solid #8B6914; 
            display: flex; align-items: center; padding: 8px 15px; justify-content: space-between; gap: 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5), inset 0 2px 0 rgba(139, 105, 20, 0.1);
            flex-wrap: nowrap; overflow-x: auto;
        }
        #dashboard .btn { padding: 5px 10px; font-size: 12px; }
        #dashboard .separator { height: 40px; }
        .stats-group { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
        .rci-container { background: rgba(0,0,0,0.4); border: 2px solid #5C4A3D; border-radius: 6px; padding: 6px 10px; flex-shrink: 0; }
        .dashboard-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
        
        /* Stats */
        .stat { 
            display: flex; flex-direction: column; margin-right: 4px; padding: 4px 8px;
            background: linear-gradient(145deg, rgba(74, 58, 40, 0.9) 0%, rgba(50, 40, 28, 0.9) 100%);
            border-radius: 4px; border: 1px solid rgba(92, 74, 61, 0.6);
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 2px 4px rgba(0,0,0,0.3);
        }
        .stat:hover { background: linear-gradient(145deg, rgba(92, 74, 50, 0.95) 0%, rgba(60, 48, 35, 0.95) 100%); border-color: #8B6914; }
        .lbl { font-size: 9px; color: #A89070; text-transform: uppercase; letter-spacing: 0.3px; font-weight: 600; margin-bottom: 1px; }
        .val { font-size: 14px; font-weight: 700; letter-spacing: -0.3px; color: #F5E6C8; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        
        /* Buttons */
        .btn { 
            padding: 10px 14px; border: 2px solid #5C4A3D; 
            background: linear-gradient(145deg, #4A3D30 0%, #3D3025 50%, #2E251B 100%);
            color: #D4C4A8; cursor: pointer; font-weight: 600; border-radius: 6px; 
            font-family: 'Segoe UI', sans-serif; font-size: 18px; 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 8px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.08), inset 0 -2px 4px rgba(0,0,0,0.3);
            white-space: nowrap; position: relative; overflow: hidden; min-width: 44px;
            display: inline-flex; align-items: center; justify-content: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .btn:hover { 
            background: linear-gradient(145deg, #5C4A3D 0%, #4A3D30 50%, #3D3025 100%);
            border-color: #8B6914; color: #F5E6C8; transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 105, 20, 0.4), 0 0 20px rgba(139, 105, 20, 0.2), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        .btn.active { 
            background: linear-gradient(145deg, #4A7A2A 0%, #3D6B22 50%, #2E5E1A 100%) !important; 
            border-color: #6B9B4A; color: #E8F5E9; 
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.5), 0 4px 15px rgba(76, 175, 80, 0.4), inset 0 2px 0 rgba(255,255,255,0.15), inset 0 -2px 6px rgba(0,0,0,0.3);
        }
        .btn:disabled { opacity: 0.35; cursor: not-allowed; background: linear-gradient(145deg, #2E2E28 0%, #252520 100%); color: #5A5A52; border-color: #3A3A35; }
        
        .b-res { border-bottom: 3px solid var(--c-res); } 
        .b-com { border-bottom: 3px solid var(--c-com); }
        .b-ind { border-bottom: 3px solid var(--c-ind); } 
        .b-wat { border-bottom: 3px solid var(--c-wat); } 
        .b-road { border-bottom: 3px solid var(--c-road); }
        
        /* Menu Panels */
        #building-menu-panel, #industrial-menu-panel, #commercial-menu-panel, #special-menu-panel, #milestone-menu-panel, #road-menu-panel, #well-menu-panel { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: linear-gradient(145deg, rgba(25, 60, 35, 0.98) 0%, rgba(15, 45, 25, 0.98) 50%, rgba(20, 55, 30, 0.98) 100%);
            border: 4px solid #4CAF50; border-radius: 16px; padding: 25px; display: none; z-index: 1001;
            box-shadow: 0 0 0 2px #2E7D32, 0 0 60px rgba(76, 175, 80, 0.5), 0 0 100px rgba(129, 199, 132, 0.2), inset 0 0 80px rgba(0,0,0,0.3), 0 20px 60px rgba(0,0,0,0.8);
            width: 75vw; max-width: 1200px; max-height: 85vh;
        }
        #industrial-menu-panel { 
            background: linear-gradient(145deg, rgba(60, 25, 20, 0.98) 0%, rgba(45, 18, 15, 0.98) 50%, rgba(55, 22, 18, 0.98) 100%);
            border-color: #FF5722;
            box-shadow: 0 0 0 2px #E64A19, 0 0 60px rgba(255, 87, 34, 0.5), inset 0 0 80px rgba(0,0,0,0.3), 0 20px 60px rgba(0,0,0,0.8);
        }
        #commercial-menu-panel { 
            background: linear-gradient(145deg, #1a1a2e 0%, #151528 100%);
            border-color: #4a9eff; min-width: 400px; width: auto;
        }
        #special-menu-panel, #milestone-menu-panel { 
            background: linear-gradient(145deg, #1a1a2e 0%, #151528 100%);
            border-color: #FFD700; min-width: 400px; width: auto;
        }
        #road-menu-panel { 
            background: linear-gradient(145deg, rgba(60, 45, 35, 0.98) 0%, rgba(40, 30, 22, 0.98) 100%);
            border-color: #8D6E63; min-width: 420px; width: auto;
        }
        
        .menu-title { font-size: 22px; font-weight: bold; color: #C8E6C9; margin-bottom: 20px; margin-top: 10px; text-align: center; text-shadow: 0 2px 8px rgba(0,0,0,0.6); letter-spacing: 2px; padding-bottom: 15px; border-bottom: 3px solid rgba(129, 199, 132, 0.4); }
        .menu-close-btn { position: absolute; top: 10px; right: 10px; background: linear-gradient(145deg, #8B4513 0%, #5C2E0A 100%); border: 2px solid #A0522D; color: #FFE4C4; width: 30px; height: 30px; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; }
        .menu-close-btn:hover { background: linear-gradient(145deg, #CD853F 0%, #8B4513 100%); transform: scale(1.1); }
        
        .level-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-height: 65vh; overflow-y: auto; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 6px; }
        .level-card { 
            background: linear-gradient(145deg, rgba(45, 80, 55, 0.95) 0%, rgba(30, 60, 40, 0.95) 100%);
            border: 3px solid #4CAF50; border-radius: 12px; padding: 16px 14px; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;
            min-height: 280px; min-width: 220px;
        }
        .level-card:hover { background: linear-gradient(145deg, rgba(60, 100, 70, 0.98) 0%, rgba(40, 80, 55, 0.98) 100%); border-color: #81C784; transform: translateY(-5px) scale(1.03); }
        .level-card.selected { background: linear-gradient(145deg, rgba(76, 175, 80, 0.4) 0%, rgba(56, 142, 60, 0.35) 100%); border-color: #A5D6A7; box-shadow: 0 0 35px rgba(129, 199, 132, 0.6); transform: scale(1.05); }
        .level-card.level-locked { opacity: 0.4; cursor: not-allowed; filter: grayscale(60%) brightness(0.8); }
        .level-card .level-icon { text-align: center; margin-bottom: 8px; display: flex; justify-content: center; align-items: center; }
        .level-card .level-number { position: absolute; top: 6px; left: 8px; font-size: 10px; color: #fff; font-weight: bold; background: linear-gradient(135deg, #4CAF50, #388E3C); padding: 3px 8px; border-radius: 10px; }
        .level-card .level-name { font-size: 12px; font-weight: 700; color: #fff; text-align: center; margin-bottom: 6px; line-height: 1.3; min-height: 30px; }
        .level-card .level-stats { font-size: 10px; color: #A5D6A7; text-align: center; margin-bottom: 6px; background: rgba(0,0,0,0.2); padding: 3px 6px; border-radius: 6px; }
        .level-card .level-cost { font-size: 10px; color: #FFE082; text-align: center; font-weight: 600; padding: 6px 4px; margin-top: 6px; border-top: 2px solid rgba(255, 224, 130, 0.3); }
        
        /* Toast */
        #toast { 
            position: absolute; top: 85px; left: 50%; transform: translateX(-50%); 
            background: linear-gradient(145deg, rgba(60, 45, 30, 0.98) 0%, rgba(40, 30, 20, 0.98) 100%);
            border: 3px solid #8B6914; color: #F5E6C8; padding: 20px 50px; border-radius: 8px; 
            opacity: 0; transition: opacity 0.3s ease; pointer-events: none; z-index: 300; 
            font-weight: 700; font-size: 16px;
        }
        
        /* Debug - hidden by default */
        #debug { display: none; position: absolute; bottom: 10px; right: 10px; font-size: 11px; color: #8B8B7A; pointer-events: none; z-index: 101; background: rgba(40, 35, 25, 0.85); padding: 5px 10px; border-radius: 4px; font-family: 'Courier New', monospace; }
        
        /* Modals */
        #log-modal, #stats-menu, #newgame-confirm-modal { display: none; }
        #log-modal.active, #stats-menu.active, #newgame-confirm-modal.active { display: flex; }
        
        /* Lore popup */
        #lore-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 5000; background: linear-gradient(145deg, #2a1a0a 0%, #1a1205 50%, #0f0a03 100%); border: 6px solid #d4a85a; border-radius: 20px; padding: 0; max-width: 500px; width: 90%; box-shadow: 0 0 60px rgba(212, 168, 90, 0.4), 0 15px 40px rgba(0,0,0,0.8); animation: lorePopIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); overflow: hidden; }
        @keyframes lorePopIn { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        #lore-popup-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 4999; backdrop-filter: blur(4px); }
        .lore-illustration { width: 100%; height: 200px; background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 50%, #7DB87D 100%); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; border-bottom: 4px solid #d4a85a; }
        .lore-content { padding: 25px; text-align: center; }
        .lore-title { font-size: 24px; font-weight: bold; color: #ffd700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-bottom: 15px; }
        .lore-text { font-size: 16px; color: #e8dcc8; line-height: 1.7; font-style: italic; margin-bottom: 20px; }
        .lore-close-btn { padding: 12px 35px; background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%); border: 3px solid #66BB6A; border-radius: 30px; color: #fff; font-size: 16px; font-weight: bold; cursor: pointer; }
        
        /* Game over */
        #gameover-screen { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(30, 25, 20, 0.97); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; font-family: serif; overflow-y: auto; padding: 20px 0; }
        
        /* Needs panel */
        #needs-warning-panel { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(145deg, rgba(60, 35, 25, 0.98) 0%, rgba(40, 25, 18, 0.98) 100%); border: 3px solid #B44B4B; border-radius: 8px; padding: 15px; width: 300px; font-size: 13px; display: none; z-index: 100; }
        
        /* UI Root for dynamic content */
        #ui-root { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        #ui-root > * { pointer-events: auto; }
        
        /* Hide file input */
        #file-input { display: none; }
        
        /* Mobile responsive */
        @media screen and (max-width: 768px) {
            .btn { padding: 8px 10px; font-size: 14px; min-width: 36px; }
            .stat { padding: 4px 8px; }
            .stat .lbl { font-size: 8px; }
            .stat .val { font-size: 14px; }
            .level-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 8px !important; }
            .level-card { min-height: 100px !important; padding: 10px 8px !important; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <h1>ğŸ›ï¸ Civil Zones</h1>
        <div class="spinner"></div>
        <div class="status">Initializing game engine...</div>
    </div>

    <!-- Lore Popup -->
    <div id="lore-popup-overlay"></div>
    <div id="lore-popup">
        <div class="lore-illustration">
            <canvas id="lore-canvas" width="500" height="200"></canvas>
        </div>
        <div class="lore-content">
            <div class="lore-title" id="lore-title">The Journey Begins</div>
            <div class="lore-text" id="lore-text">Early man had a dream...</div>
            <button class="lore-close-btn" id="lore-close-btn">Continue Journey</button>
        </div>
    </div>

    <!-- Log Modal -->
    <div id="log-modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;">
        <div style="background:#222;color:#fff;padding:24px 32px;max-width:800px;width:90vw;max-height:85vh;overflow:hidden;border-radius:8px;box-shadow:0 4px 32px #000;position:relative;display:flex;flex-direction:column;">
            <button id="close-log-modal" style="position:absolute;top:8px;right:8px;font-size:1.5em;background:none;border:none;color:#fff;cursor:pointer;z-index:1;">âœ–</button>
            <h2 style="margin:0 0 12px 0;">Game Logs</h2>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
                <button id="btn-player-log" style="padding:8px 16px;background:#4CAF50;color:#fff;border:none;border-radius:4px;cursor:pointer;font-weight:bold;">Player Log</button>
                <button id="btn-technical-log" style="padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;cursor:pointer;">Technical Log</button>
            </div>
            <pre id="log-content" style="white-space:pre-wrap;word-wrap:break-word;font-family:monospace;font-size:0.85em;background:#181818;padding:12px;border-radius:6px;overflow-y:auto;flex:1;margin:0;"></pre>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"></div>

    <!-- Game Over Screen -->
    <div id="gameover-screen">
        <div id="newspaper-article" style="max-width:700px; background:#F5F0E1; color:#222; padding:40px 50px; margin:20px; border-radius:4px; box-shadow:0 10px 40px rgba(0,0,0,0.5); border:1px solid #D4C9B0;">
            <div style="text-align:center; border-bottom:3px double #333; padding-bottom:15px; margin-bottom:20px;">
                <div style="font-size:0.75em; color:#666; letter-spacing:4px; text-transform:uppercase;">The Prehistoric Times</div>
                <div id="newspaper-date" style="font-size:0.85em; color:#888; margin-top:5px;">January 12, 2026</div>
            </div>
            <canvas id="fossil-illustration" width="280" height="140" style="display:block;margin:0 auto 10px;background:#E8DCC8; border:2px solid #998; border-radius:8px;"></canvas>
            <h1 id="newspaper-headline" style="font-family:'Times New Roman',serif; font-size:2.2em; font-weight:900; text-align:center; line-height:1.2; margin:0 0 15px 0; color:#111;">Settlement Failed</h1>
            <div id="newspaper-body" style="font-family:Georgia,serif; font-size:1em; line-height:1.7; color:#333; text-align:justify;"></div>
            <div id="newspaper-stats" style="margin-top:25px; padding:15px; background:#EDE8D9; border:1px solid #ccc; border-radius:3px; font-family:'Courier New',monospace; font-size:0.9em;"></div>
            <div style="text-align:center; margin-top:30px;">
                <button id="btn-newgame-gameover" style="font-size:1.2em; padding:15px 40px; background:#8B4513; color:#F5F0E1; border:none; border-radius:6px; font-family:serif; font-weight:bold; cursor:pointer; box-shadow:0 3px 10px rgba(0,0,0,0.3); transition:background 0.2s;">Try Again</button>
            </div>
        </div>
    </div>

    <!-- Top Menubar -->
    <div id="menubar">
        <div style="font-weight:700; font-size:14px; margin-right:10px; color:#D4A040; white-space:nowrap;">CIVIL ZONES</div>
        <div class="separator"></div>
        <button class="btn" id="t-pan" title="Pan Camera">âœ‹</button>
        <button class="btn b-road" id="t-road" title="Build Roads">ğŸ›£ï¸</button>
        <button class="btn b-wat" id="t-well" title="Build Well">ğŸ’§</button>
        <div class="separator"></div>
        <button class="btn" id="t-demolish" title="Demolish">ğŸ”¨</button>
        <button class="btn b-res" id="t-res" title="Build Residential">ğŸ—ï¸</button>
        <button class="btn b-com" id="t-com" title="Build Commercial">ğŸ¢</button>
        <button class="btn b-ind" id="t-ind" title="Build Industrial">ğŸ­</button>
        <button class="btn" id="t-special" title="Special Buildings">â­</button>
        <button class="btn" id="t-milestone" title="Milestone Buildings">ğŸ›ï¸</button>
        <button class="btn" id="t-exchange" style="background:#FFD700;color:#000;" title="Exchange Metal for Gold">ğŸ’°</button>
        <div class="separator"></div>
        <button class="btn" id="btn-settle" style="background:#4CAF50;border-color:#81C784;display:none;" title="Start Settlement">ğŸ›ï¸ Settle</button>
        <button class="btn" id="btn-turn" title="Pass Turn">â­ï¸</button>
        <div style="flex-grow:1;"></div>
        <button class="btn" id="btn-view" title="Toggle View">ğŸ‘ï¸</button>
        <button class="btn" id="btn-save" title="Save Game">ğŸ’¾</button>
        <button class="btn" id="btn-load" title="Load Game">ğŸ“‚</button>
        <button class="btn" id="btn-zoom-in" title="Zoom In">ğŸ”+</button>
        <button class="btn" id="btn-zoom-out" title="Zoom Out">ğŸ”-</button>
        <button class="btn" id="btn-reset" title="New Game">ğŸ”„</button>
        <div class="separator"></div>
        <div class="menubar-right">
            <button class="btn debug-btn" id="btn-elevation" style="background:#2196F3;" title="Toggle Elevation">ğŸ—»</button>
            <button class="btn debug-btn" id="btn-add-pop" style="background:#9C27B0;" title="+1000 Pop">ğŸ‘¥+1k</button>
            <button class="btn debug-btn" id="btn-add-res" style="background:#FF5722;" title="+1000 Resources">ğŸ“¦+1k</button>
            <button class="btn" id="btn-lore" title="Toggle Lore">ğŸ“–</button>
            <button class="btn" id="btn-ai" title="AI Panel">ğŸ¤–</button>
            <button class="btn" id="btn-log" title="Game Log">ğŸ“œ</button>
        </div>
    </div>

    <!-- Building Menu Panel -->
    <div id="building-menu-panel">
        <button class="menu-close-btn" id="close-building-menu">Ã—</button>
        <div class="menu-title">ğŸ  Select Your Home</div>
        <div class="level-grid" id="building-level-grid"></div>
        <div style="text-align:center;margin-top:15px;font-size:12px;color:#A5D6A7;">ğŸŒŸ Tip: Homes near roads and water grow faster!</div>
        <div style="text-align:center;margin-top:15px;">
            <button class="btn" id="confirm-building" style="background:linear-gradient(135deg,#66BB6A,#43A047);padding:12px 40px;">ğŸ  Build Home</button>
        </div>
    </div>

    <!-- Industrial Menu Panel -->
    <div id="industrial-menu-panel">
        <button class="menu-close-btn" id="close-industrial-menu">Ã—</button>
        <div class="menu-title" style="color:#FFCCBC;">âš’ï¸ Select Workshop</div>
        <div class="level-grid" id="industrial-level-grid"></div>
        <div style="text-align:center;margin-top:15px;font-size:12px;color:#FFAB91;">ğŸ”¥ Tip: Build on ore deposits for bonus resources!</div>
        <div style="text-align:center;margin-top:15px;">
            <button class="btn" id="confirm-industrial" style="background:linear-gradient(135deg,#FF7043,#E53935);padding:12px 40px;">âš’ï¸ Build Workshop</button>
        </div>
    </div>

    <!-- Commercial Menu Panel -->
    <div id="commercial-menu-panel">
        <button class="menu-close-btn" id="close-commercial-menu">Ã—</button>
        <div class="menu-title" style="color:#4a9eff;">ğŸª Choose Commercial Type</div>
        <div class="level-grid" id="commercial-level-grid" style="grid-template-columns:repeat(3,1fr);"></div>
        <div style="text-align:center;margin-top:10px;font-size:11px;color:#999;">ğŸ’¡ Commercial buildings generate income!</div>
        <div style="text-align:center;margin-top:10px;">
            <button class="btn" id="confirm-commercial" style="background:#4a9eff;padding:10px 30px;">âœ“ Build Selected</button>
        </div>
    </div>

    <!-- Special Menu Panel -->
    <div id="special-menu-panel">
        <button class="menu-close-btn" id="close-special-menu">Ã—</button>
        <div class="menu-title" style="color:#FFD700;">â­ Special Buildings</div>
        <div class="level-grid" id="special-level-grid" style="grid-template-columns:repeat(3,1fr);"></div>
        <div style="text-align:center;margin-top:10px;font-size:11px;color:#999;">ğŸ’¡ Special buildings provide unique bonuses!</div>
        <div style="text-align:center;margin-top:10px;">
            <button class="btn" id="confirm-special" style="background:#FFD700;color:#000;padding:10px 30px;">âœ“ Build Selected</button>
        </div>
    </div>

    <!-- Milestone Menu Panel -->
    <div id="milestone-menu-panel">
        <button class="menu-close-btn" id="close-milestone-menu">Ã—</button>
        <div class="menu-title" style="color:#FFD700;">ğŸ›ï¸ Milestone Buildings</div>
        <div style="text-align:center;margin-bottom:15px;font-size:12px;color:#aaa;">Milestone buildings unlock new tiers!</div>
        <div class="level-grid" id="milestone-level-grid" style="grid-template-columns:repeat(2,1fr);"></div>
        <div style="text-align:center;margin-top:15px;padding:10px;background:#2a2a4a;border-radius:8px;">
            <div style="font-size:12px;color:#FFD700;">ğŸ’° Gold Exchange: 5,000 Metal = 1 Gold</div>
            <div style="font-size:13px;color:#fff;margin-top:5px;">Metal: <span id="milestone-metal-display">0</span> | Gold: <span id="milestone-gold-display">0</span></div>
        </div>
        <div style="text-align:center;margin-top:15px;">
            <button class="btn" id="confirm-milestone" style="background:#FFD700;color:#000;padding:10px 30px;">âœ“ Build Selected</button>
        </div>
    </div>

    <!-- Road Menu Panel -->
    <div id="road-menu-panel">
        <button class="menu-close-btn" id="close-road-menu">Ã—</button>
        <div class="menu-title" style="color:#BCAAA4;">ğŸ›£ï¸ Choose Road Type</div>
        <div class="level-grid" id="road-level-grid">
            <div class="level-card selected" id="card-road-1"><div class="level-icon">ğŸš¶</div><div class="level-name">Path</div><div class="level-stats">Level 1 â€¢ Basic footpath</div><div class="level-cost">Cost: $5</div></div>
            <div class="level-card level-locked" id="card-road-2"><div class="level-icon">ğŸ›¤ï¸</div><div class="level-name">Road</div><div class="level-stats">Level 2 â€¢ Coming Soon</div><div class="level-cost">ğŸ”’ Locked</div></div>
            <div class="level-card level-locked" id="card-road-3"><div class="level-icon">ğŸš—</div><div class="level-name">Paved Road</div><div class="level-stats">Level 3 â€¢ Coming Soon</div><div class="level-cost">ğŸ”’ Locked</div></div>
            <div class="level-card level-locked" id="card-road-4"><div class="level-icon">ğŸï¸</div><div class="level-name">Highway</div><div class="level-stats">Level 4 â€¢ Coming Soon</div><div class="level-cost">ğŸ”’ Locked</div></div>
        </div>
        <div style="text-align:center;margin-top:10px;font-size:11px;color:#999;">ğŸ’¡ Roads improve desirability!</div>
        <div style="text-align:center;margin-top:10px;">
            <button class="btn" id="confirm-road" style="background:var(--c-road);padding:10px 30px;">âœ“ Build Road</button>
        </div>
    </div>

    <!-- Well Menu Panel -->
    <div id="well-menu-panel">
        <button class="menu-close-btn" id="close-well-menu">Ã—</button>
        <div class="menu-title" style="color:#00e5ff;">ğŸ’§ Build Well</div>
        <div style="text-align:center;padding:20px;">
            <div style="font-size:48px;margin-bottom:15px;">ğŸ•³ï¸</div>
            <div style="font-size:14px;color:#aaa;margin-bottom:20px;">Wells provide water for your settlement.<br>Each well supports 100 population.</div>
        </div>
        <div style="text-align:center;margin-top:10px;">
            <button class="btn" id="confirm-well" style="background:#00e5ff;color:#000;padding:10px 30px;">ğŸ’§ Build Well</button>
        </div>
    </div>

    <!-- Viewport with Canvas -->
    <div id="viewport">
        <div id="canvas-container">
            <canvas id="game-canvas"></canvas>
            <div id="ui-root"></div>
        </div>
        <div id="debug">Pos: 0, 0</div>
    </div>

    <!-- Bottom Dashboard -->
    <div id="dashboard">
        <div id="rci-meters" class="rci-container">
            <div style="display:flex;gap:4px;align-items:flex-end;height:45px;">
                <div style="display:flex;flex-direction:column;align-items:center;height:100%;">
                    <div style="flex:1;width:14px;background:#1A1510;border:1px solid #5C4A3D;border-radius:2px;display:flex;flex-direction:column-reverse;overflow:hidden;">
                        <div id="r-bar-fill" style="width:100%;background:linear-gradient(to top,#2E7D32,#4CAF50);height:40%;"></div>
                    </div>
                    <span style="color:#4CAF50;font-weight:bold;font-size:9px;margin-top:1px;">R</span>
                </div>
                <div style="display:flex;flex-direction:column;align-items:center;height:100%;">
                    <div style="flex:1;width:14px;background:#1A1510;border:1px solid #5C4A3D;border-radius:2px;display:flex;flex-direction:column-reverse;overflow:hidden;">
                        <div id="c-bar-fill" style="width:100%;background:linear-gradient(to top,#1565C0,#42A5F5);height:50%;"></div>
                    </div>
                    <span style="color:#42A5F5;font-weight:bold;font-size:9px;margin-top:1px;">C</span>
                </div>
                <div style="display:flex;flex-direction:column;align-items:center;height:100%;">
                    <div style="flex:1;width:14px;background:#1A1510;border:1px solid #5C4A3D;border-radius:2px;display:flex;flex-direction:column-reverse;overflow:hidden;">
                        <div id="i-bar-fill" style="width:100%;background:linear-gradient(to top,#E65100,#FF9800);height:50%;"></div>
                    </div>
                    <span style="color:#FF9800;font-weight:bold;font-size:9px;margin-top:1px;">I</span>
                </div>
            </div>
            <div id="rci-tooltip" style="font-size:8px;color:#8B7355;text-align:center;margin-top:2px;">R:0 C:0 I:0</div>
        </div>
        <div class="separator"></div>
        <button class="btn" id="btn-pass-year-dash" style="display:none;background:#388E3C;color:#fff;" title="Pass Year">â©</button>
        <div class="stats-group">
            <div class="stat"><span class="lbl">Pop</span><span class="val" id="v-pop" style="color:var(--c-res)">0</span></div>
            <div class="stat"><span class="lbl">Food</span><span class="val" id="v-food" style="color:#4CAF50">0/0</span></div>
            <div class="stat" id="stat-wood"><span class="lbl">Wood</span><span class="val" id="v-wood" style="color:#A86838">0</span></div>
            <div class="stat" id="stat-metal"><span class="lbl">Metal</span><span class="val" id="v-metal" style="color:#78909C">0</span></div>
            <div class="stat" id="stat-stone"><span class="lbl">Stone</span><span class="val" id="v-stone" style="color:#9E9E9E">0</span></div>
            <div class="stat" id="stat-inventory"><span class="lbl">Inv</span><span class="val" id="v-inventory" style="color:#64B5F6">0/0</span></div>
            <div class="stat" id="stat-year"><span class="lbl">Year</span><span class="val" id="v-year" style="color:#9E9E9E">0</span></div>
            <div class="stat" id="stat-thirst"><span class="lbl">ğŸ’§ Thirst</span><span class="val" id="v-thirst" style="color:#29B6F6">100</span></div>
            <div class="stat" id="stat-water"><span class="lbl">ğŸ’§ Water</span><span class="val" id="v-wat" style="color:var(--c-wat)">0/0</span></div>
            <div class="stat" id="stat-funds"><span class="lbl">Gold</span><span class="val" id="v-res" style="color:var(--c-com)">0</span></div>
        </div>
        <div class="separator"></div>
        <div class="dashboard-right">
            <div class="val" id="v-epoch" style="font-size:11px;font-weight:600;color:#D4A040;">ğŸŒ EXPLORING</div>
            <button class="btn" id="btn-newgame" style="background:#1976D2;color:#fff;">ğŸ†•</button>
            <button class="btn" id="btn-stats" title="Stats">ğŸ“Š</button>
        </div>
    </div>

    <!-- Stats Menu -->
    <div id="stats-menu" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(145deg,rgba(60,45,30,0.98) 0%,rgba(40,30,20,0.98) 100%);border:3px solid #8B6914;border-radius:8px;padding:25px;max-width:500px;min-width:400px;z-index:1000;color:#F5E6C8;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
            <h3 style="margin:0;color:#D4A040;">ğŸ“Š Tribe Statistics</h3>
            <button id="close-stats-menu" style="background:linear-gradient(145deg,#6B4423 0%,#4A3018 100%);border:2px solid #8B6914;color:#F5E6C8;font-size:16px;width:32px;height:32px;border-radius:4px;cursor:pointer;">Ã—</button>
        </div>
        <div id="stats-content" style="line-height:1.8;font-size:14px;color:#C4A878;"></div>
    </div>
    <div id="stats-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:999;"></div>

    <!-- New Game Confirm Modal -->
    <div id="newgame-confirm-modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:10000;align-items:center;justify-content:center;">
        <div style="background:linear-gradient(145deg,rgba(60,35,25,0.98) 0%,rgba(40,25,18,0.98) 100%);border:4px solid #B44B4B;border-radius:10px;padding:30px;max-width:450px;width:85vw;color:#F5E6C8;text-align:center;">
            <div style="font-size:48px;margin-bottom:15px;">âš ï¸</div>
            <h2 style="margin:0 0 15px 0;color:#FF8B8B;font-size:24px;">Abandon Tribe?</h2>
            <p style="margin:0 0 25px 0;color:#C4A878;font-size:16px;line-height:1.5;">All progress will be lost!<br>This cannot be undone.</p>
            <div style="display:flex;gap:15px;justify-content:center;">
                <button id="confirm-newgame-yes" style="padding:12px 30px;background:linear-gradient(145deg,#B44B4B 0%,#8B3030 100%);color:#F5E6C8;border:2px solid #D06060;border-radius:6px;font-size:16px;font-weight:700;cursor:pointer;">âœ“ Yes, Restart</button>
                <button id="confirm-newgame-no" style="padding:12px 30px;background:linear-gradient(145deg,#4A7A2A 0%,#3D6B22 100%);color:#E8F5E9;border:2px solid #6B9B4A;border-radius:6px;font-size:16px;font-weight:700;cursor:pointer;">âœ— Keep Playing</button>
            </div>
        </div>
    </div>

    <!-- Needs Warning Panel -->
    <div id="needs-warning-panel">
        <div style="color:#FF8B8B;font-weight:bold;margin-bottom:10px;">âš ï¸ TRIBE NEEDS:</div>
        <div id="needs-list" style="color:#F5E6C8;line-height:1.6;"></div>
        <div id="satisfaction-meter" style="margin-top:10px;background:rgba(40,30,22,0.9);height:20px;border-radius:4px;overflow:hidden;border:2px solid #5C4A3D;">
            <div id="satisfaction-bar" style="background:linear-gradient(90deg,#B44B4B 0%,#D4A040 50%,#5A9A5A 100%);height:100%;width:50%;display:flex;align-items:center;justify-content:center;color:#F5E6C8;font-size:10px;font-weight:bold;">50%</div>
        </div>
    </div>

    <!-- AI Training Panel (hidden by default) -->
    <div id="ai-training-panel" style="position:fixed;bottom:10px;right:10px;background:rgba(20,20,30,0.95);color:#fff;padding:15px;border-radius:8px;font-family:monospace;font-size:12px;z-index:9000;border:2px solid #4a9eff;min-width:280px;display:none;">
        <div style="font-weight:bold;font-size:14px;margin-bottom:5px;color:#4a9eff;">ğŸ¤– AI Training Panel</div>
        <div style="color:#888;font-size:10px;">AI features available in TypeScript version</div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="file-input" accept=".json">

    <!-- Load TypeScript Game Engine -->
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
