{"version":3,"file":"game-rendering-BJK6da9S.js","sources":["../../src/rendering/colors.ts","../../src/rendering/draw-utils.ts","../../src/rendering/camera.ts","../../src/rendering/effects.ts","../../src/ui/types.ts","../../src/ui/toast.ts","../../src/ui/menus.ts","../../src/ui/hud.ts","../../src/ui/logging.ts"],"sourcesContent":["/**\r\n * Civil Zones - Rendering Colors & Constants\r\n * Victorian parchment map theme colors and visual configuration\r\n */\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TERRAIN COLORS - Aged parchment & ink tones\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const TERRAIN_COLORS = {\r\n    DEEP: '#4A6B8A',\r\n    WATER: '#6B8FAD',\r\n    RIVER: '#7FA0B8',\r\n    SAND: '#D4C4A8',\r\n    GRASS: '#C9D4A0',\r\n    FOREST: '#8B9A6B',\r\n    EARTH: '#C4A882',\r\n    ROCK: '#9A9A8A',\r\n    SNOW: '#E8E8E0',\r\n    STONE: '#8A8A7A'\r\n} as const;\r\n\r\nexport type TerrainColorKey = keyof typeof TERRAIN_COLORS;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// BUILDING COLORS - Ink & wash tones\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const BUILDING_COLORS = {\r\n    ROAD: '#A89070',\r\n    RES: '#C4946A',\r\n    COM: '#B8A060',\r\n    IND: '#8A7A6A',\r\n    WELL: '#6A8A9A',\r\n    BASKET: '#B89A70',\r\n    POTTERY: '#A8906A',\r\n    GRANARY: '#9A8A70',\r\n    PALACE: '#D4B480',\r\n    CHIEF: '#C4A070',\r\n    CLAN_CHIEF: '#D4B060',\r\n    DOCK: '#5A7A8A'\r\n} as const;\r\n\r\nexport type BuildingColorKey = keyof typeof BUILDING_COLORS;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// MAP OVERLAY COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const MAP_COLORS = {\r\n    PARCHMENT: '#E8DCC8',\r\n    INK: '#3A3020',\r\n    SEPIA: '#704020',\r\n    FOG_OF_WAR: '#C8B8A0'\r\n} as const;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// UI COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const UI_COLORS = {\r\n    OK: 'rgba(180,160,120,0.5)',\r\n    NO: 'rgba(160,80,60,0.85)',\r\n    PANEL_BG: 'rgba(40,35,30,0.95)',\r\n    PANEL_BORDER: 'rgba(180,160,120,0.5)',\r\n    TEXT_PRIMARY: '#E8DCC8',\r\n    TEXT_SECONDARY: '#A09080',\r\n    TEXT_HIGHLIGHT: '#FFD700',\r\n    TEXT_DANGER: '#FF6666',\r\n    TEXT_SUCCESS: '#66FF66',\r\n    BUTTON_BG: 'rgba(80,70,60,0.8)',\r\n    BUTTON_HOVER: 'rgba(100,90,80,0.9)',\r\n    BUTTON_ACTIVE: 'rgba(120,100,80,1.0)'\r\n} as const;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// ZONE COLORS (for R/C/I zones)\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const ZONE_COLORS = {\r\n    R: { fill: 'rgba(100,180,100,0.3)', stroke: '#4A8A4A' },  // Green - Residential\r\n    C: { fill: 'rgba(100,100,200,0.3)', stroke: '#4A4A9A' },  // Blue - Commercial\r\n    I: { fill: 'rgba(180,140,60,0.3)', stroke: '#9A8A3A' }    // Yellow - Industrial\r\n} as const;\r\n\r\nexport type ZoneColorKey = keyof typeof ZONE_COLORS;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// DESIRABILITY HEATMAP COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Get heatmap color for desirability value\r\n * Red (0) -> Yellow (0.5) -> Green (1.0) -> Blue (1.5+)\r\n */\r\nexport function getDesirabilityColor(desirability: number, alpha: number = 0.5): string {\r\n    let r: number, g: number, b: number;\r\n    \r\n    if (desirability < 0.3) {\r\n        r = 255;\r\n        g = Math.floor(desirability * 850);\r\n        b = 0;\r\n    } else if (desirability < 0.7) {\r\n        r = Math.floor(255 - (desirability - 0.3) * 600);\r\n        g = 255;\r\n        b = 0;\r\n    } else if (desirability < 1.2) {\r\n        r = 0;\r\n        g = 255;\r\n        b = Math.floor((desirability - 0.7) * 510);\r\n    } else {\r\n        r = 0;\r\n        g = Math.floor(255 - (desirability - 1.2) * 200);\r\n        b = 255;\r\n    }\r\n    \r\n    return `rgba(${r},${g},${b},${alpha})`;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// ELEVATION OVERLAY COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Get elevation overlay color based on height relative to sea level\r\n */\r\nexport function getElevationOverlayColor(\r\n    tileType: string,\r\n    elevation: number,\r\n    seaLevel: number\r\n): string {\r\n    const diff = elevation - seaLevel;\r\n    \r\n    if (tileType === 'WATER' || tileType === 'DEEP' || tileType === 'RIVER') {\r\n        return 'rgba(0, 50, 150, 0.4)'; // Already water\r\n    }\r\n    \r\n    if (diff < 0) {\r\n        return 'rgba(255, 0, 0, 0.5)';      // BELOW SEA - RED\r\n    } else if (diff < 0.5) {\r\n        return 'rgba(255, 100, 0, 0.45)';   // HIGH RISK - ORANGE\r\n    } else if (diff < 1.0) {\r\n        return 'rgba(255, 200, 0, 0.4)';    // WARNING - YELLOW\r\n    } else if (diff < 2.0) {\r\n        return 'rgba(0, 180, 0, 0.3)';      // SAFE - GREEN\r\n    } else {\r\n        return 'rgba(0, 100, 255, 0.25)';   // HIGH GROUND - BLUE\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// BUILDING LEVEL COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/** Generate colors for a building level (1-6) */\r\nexport function generateLevelColors(level: number): {\r\n    wall: string;\r\n    wallDark: string;\r\n    roof: string;\r\n    roofDark: string;\r\n    wood: string;\r\n    woodDark: string;\r\n} {\r\n    // Hue shifts from earthy (level 1) to more refined (level 6)\r\n    const hueBase = 30 + level * 5; // 35-60 range\r\n    const saturation = 40 + level * 8; // 48-88%\r\n    const lightness = 45 + level * 5; // 50-75%\r\n    \r\n    return {\r\n        wall: `hsl(${hueBase}, ${saturation}%, ${lightness}%)`,\r\n        wallDark: `hsl(${hueBase}, ${saturation}%, ${lightness - 15}%)`,\r\n        roof: `hsl(${hueBase - 10}, ${saturation - 10}%, ${lightness - 10}%)`,\r\n        roofDark: `hsl(${hueBase - 10}, ${saturation - 10}%, ${lightness - 25}%)`,\r\n        wood: `hsl(${hueBase + 5}, ${saturation - 20}%, ${lightness - 5}%)`,\r\n        woodDark: `hsl(${hueBase + 5}, ${saturation - 20}%, ${lightness - 20}%)`\r\n    };\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// PARTICLE COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const PARTICLE_COLORS = {\r\n    WOOD_CHIP: ['#B8956A', '#A08050', '#C8A878', '#9A7548'],\r\n    DUST: ['#C8B8A0', '#B8A890', '#D8C8B0', '#A89880'],\r\n    WATER_SPLASH: ['#6B9FCF', '#5A8FC0', '#7CAFDF', '#4A7FB0'],\r\n    FIRE: ['#FF6600', '#FF9900', '#FFCC00', '#FF3300'],\r\n    SMOKE: ['#666666', '#555555', '#777777', '#444444'],\r\n    SPARKLE: ['#FFFFFF', '#FFFFCC', '#FFFF99', '#FFFFFF']\r\n} as const;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CHARACTER COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const CHARACTER_COLORS = {\r\n    // Logical Larry (player)\r\n    SKIN: '#DDA675',\r\n    SKIN_DARK: '#B8865C',\r\n    SKIN_LIGHT: '#C9966C',\r\n    HAIR: '#5D3A1A',\r\n    FUR_TUNIC: '#A0522D',\r\n    FUR_DARK: '#6B3A1E',\r\n    FUR_TEXTURE: '#8B4513',\r\n    BELT_BONE: '#F5F5DC',\r\n    BELT_DARK: '#B8A080',\r\n    FUR_BOOTS: '#8B6914',\r\n    BOOTS_DARK: '#5D4510',\r\n    CLUB_WOOD: '#8B7355',\r\n    CLUB_WOOD_DARK: '#5D4E3A',\r\n    CLUB_STONE: '#808080',\r\n    CLUB_STONE_DARK: '#555555',\r\n    \r\n    // Nomads\r\n    NOMAD_BODY: '#8B5A2B',\r\n    NOMAD_SPEAR: '#8B7355',\r\n    NOMAD_SPEARTIP: '#555555',\r\n    \r\n    // Animals\r\n    WOLF: '#666666',\r\n    WOLF_LIGHT: '#888888',\r\n    DEER: '#8B6914',\r\n    DEER_LIGHT: '#A08030'\r\n} as const;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// BERRY COLORS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const BERRY_COLORS = {\r\n    BUSH: '#60C060',\r\n    BUSH_HIGHLIGHT: '#90E890',\r\n    SAFE: {\r\n        light: '#FF90B0',\r\n        mid: '#FF6090',\r\n        dark: '#E04070'\r\n    },\r\n    POISON: {\r\n        light: '#E0B0FF',\r\n        mid: '#C878F0',\r\n        dark: '#A050D0'\r\n    }\r\n} as const;\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// ALL COLORS COMBINED (for CFG.COLORS compatibility)\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const ALL_COLORS = {\r\n    ...TERRAIN_COLORS,\r\n    ...BUILDING_COLORS,\r\n    ...MAP_COLORS,\r\n    ...UI_COLORS\r\n} as const;\r\n","/**\r\n * Civil Zones - Canvas Drawing Utilities\r\n * Helper functions for common 2D canvas operations\r\n */\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TYPES\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport type Context2D = CanvasRenderingContext2D;\r\n\r\nexport interface Point {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport interface Rect {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport interface Circle {\r\n    x: number;\r\n    y: number;\r\n    radius: number;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// ROUNDED RECTANGLE\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Draw a rounded rectangle path (does not fill or stroke)\r\n */\r\nexport function roundRectPath(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    r: number\r\n): void {\r\n    // Clamp radius to half of smallest dimension\r\n    const radius = Math.min(r, w / 2, h / 2);\r\n    \r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius, y);\r\n    ctx.lineTo(x + w - radius, y);\r\n    ctx.quadraticCurveTo(x + w, y, x + w, y + radius);\r\n    ctx.lineTo(x + w, y + h - radius);\r\n    ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);\r\n    ctx.lineTo(x + radius, y + h);\r\n    ctx.quadraticCurveTo(x, y + h, x, y + h - radius);\r\n    ctx.lineTo(x, y + radius);\r\n    ctx.quadraticCurveTo(x, y, x + radius, y);\r\n    ctx.closePath();\r\n}\r\n\r\n/**\r\n * Fill a rounded rectangle\r\n */\r\nexport function fillRoundRect(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    r: number\r\n): void {\r\n    roundRectPath(ctx, x, y, w, h, r);\r\n    ctx.fill();\r\n}\r\n\r\n/**\r\n * Stroke a rounded rectangle\r\n */\r\nexport function strokeRoundRect(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    r: number\r\n): void {\r\n    roundRectPath(ctx, x, y, w, h, r);\r\n    ctx.stroke();\r\n}\r\n\r\n/**\r\n * Fill and stroke a rounded rectangle\r\n */\r\nexport function drawRoundRect(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    r: number,\r\n    fillStyle?: string,\r\n    strokeStyle?: string\r\n): void {\r\n    roundRectPath(ctx, x, y, w, h, r);\r\n    \r\n    if (fillStyle) {\r\n        ctx.fillStyle = fillStyle;\r\n        ctx.fill();\r\n    }\r\n    \r\n    if (strokeStyle) {\r\n        ctx.strokeStyle = strokeStyle;\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// BASIC SHAPES\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Draw a circle\r\n */\r\nexport function drawCircle(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    radius: number,\r\n    fillStyle?: string,\r\n    strokeStyle?: string\r\n): void {\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n    \r\n    if (fillStyle) {\r\n        ctx.fillStyle = fillStyle;\r\n        ctx.fill();\r\n    }\r\n    \r\n    if (strokeStyle) {\r\n        ctx.strokeStyle = strokeStyle;\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\n/**\r\n * Draw an ellipse\r\n */\r\nexport function drawEllipse(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    radiusX: number,\r\n    radiusY: number,\r\n    rotation: number = 0,\r\n    fillStyle?: string,\r\n    strokeStyle?: string\r\n): void {\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, Math.PI * 2);\r\n    \r\n    if (fillStyle) {\r\n        ctx.fillStyle = fillStyle;\r\n        ctx.fill();\r\n    }\r\n    \r\n    if (strokeStyle) {\r\n        ctx.strokeStyle = strokeStyle;\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a line\r\n */\r\nexport function drawLine(\r\n    ctx: Context2D,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    strokeStyle: string,\r\n    lineWidth: number = 1\r\n): void {\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw a polygon from points\r\n */\r\nexport function drawPolygon(\r\n    ctx: Context2D,\r\n    points: Point[],\r\n    fillStyle?: string,\r\n    strokeStyle?: string\r\n): void {\r\n    if (points.length < 3) return;\r\n    \r\n    ctx.beginPath();\r\n    ctx.moveTo(points[0].x, points[0].y);\r\n    \r\n    for (let i = 1; i < points.length; i++) {\r\n        ctx.lineTo(points[i].x, points[i].y);\r\n    }\r\n    \r\n    ctx.closePath();\r\n    \r\n    if (fillStyle) {\r\n        ctx.fillStyle = fillStyle;\r\n        ctx.fill();\r\n    }\r\n    \r\n    if (strokeStyle) {\r\n        ctx.strokeStyle = strokeStyle;\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// BEZIER CURVES\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Draw a quadratic bezier curve\r\n */\r\nexport function drawQuadraticCurve(\r\n    ctx: Context2D,\r\n    x1: number,\r\n    y1: number,\r\n    cpX: number,\r\n    cpY: number,\r\n    x2: number,\r\n    y2: number,\r\n    strokeStyle: string,\r\n    lineWidth: number = 1\r\n): void {\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.quadraticCurveTo(cpX, cpY, x2, y2);\r\n    ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw a cubic bezier curve\r\n */\r\nexport function drawBezierCurve(\r\n    ctx: Context2D,\r\n    x1: number,\r\n    y1: number,\r\n    cp1X: number,\r\n    cp1Y: number,\r\n    cp2X: number,\r\n    cp2Y: number,\r\n    x2: number,\r\n    y2: number,\r\n    strokeStyle: string,\r\n    lineWidth: number = 1\r\n): void {\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, x2, y2);\r\n    ctx.stroke();\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TEXT DRAWING\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Draw text with optional shadow\r\n */\r\nexport function drawText(\r\n    ctx: Context2D,\r\n    text: string,\r\n    x: number,\r\n    y: number,\r\n    options: {\r\n        font?: string;\r\n        fillStyle?: string;\r\n        align?: CanvasTextAlign;\r\n        baseline?: CanvasTextBaseline;\r\n        shadow?: {\r\n            color: string;\r\n            blur: number;\r\n            offsetX?: number;\r\n            offsetY?: number;\r\n        };\r\n    } = {}\r\n): void {\r\n    const {\r\n        font = '12px sans-serif',\r\n        fillStyle = '#FFFFFF',\r\n        align = 'left',\r\n        baseline = 'alphabetic',\r\n        shadow\r\n    } = options;\r\n    \r\n    ctx.font = font;\r\n    ctx.fillStyle = fillStyle;\r\n    ctx.textAlign = align;\r\n    ctx.textBaseline = baseline;\r\n    \r\n    if (shadow) {\r\n        ctx.shadowColor = shadow.color;\r\n        ctx.shadowBlur = shadow.blur;\r\n        ctx.shadowOffsetX = shadow.offsetX || 0;\r\n        ctx.shadowOffsetY = shadow.offsetY || 0;\r\n    }\r\n    \r\n    ctx.fillText(text, x, y);\r\n    \r\n    // Reset shadow\r\n    if (shadow) {\r\n        ctx.shadowColor = 'transparent';\r\n        ctx.shadowBlur = 0;\r\n        ctx.shadowOffsetX = 0;\r\n        ctx.shadowOffsetY = 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Draw text with outline\r\n */\r\nexport function drawTextWithOutline(\r\n    ctx: Context2D,\r\n    text: string,\r\n    x: number,\r\n    y: number,\r\n    fillStyle: string,\r\n    strokeStyle: string,\r\n    font: string = '12px sans-serif',\r\n    lineWidth: number = 2\r\n): void {\r\n    ctx.font = font;\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'middle';\r\n    \r\n    // Draw outline first\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.strokeText(text, x, y);\r\n    \r\n    // Then fill\r\n    ctx.fillStyle = fillStyle;\r\n    ctx.fillText(text, x, y);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// GRADIENTS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Create a radial gradient for 3D sphere effect\r\n */\r\nexport function createSphereGradient(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    radius: number,\r\n    lightColor: string,\r\n    midColor: string,\r\n    darkColor: string\r\n): CanvasGradient {\r\n    // Offset highlight toward upper-left\r\n    const gradient = ctx.createRadialGradient(\r\n        x - radius * 0.3,\r\n        y - radius * 0.3,\r\n        radius * 0.1,\r\n        x,\r\n        y,\r\n        radius\r\n    );\r\n    \r\n    gradient.addColorStop(0, lightColor);\r\n    gradient.addColorStop(0.5, midColor);\r\n    gradient.addColorStop(1, darkColor);\r\n    \r\n    return gradient;\r\n}\r\n\r\n/**\r\n * Create a linear gradient\r\n */\r\nexport function createLinearGradient(\r\n    ctx: Context2D,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    stops: Array<{ offset: number; color: string }>\r\n): CanvasGradient {\r\n    const gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n    \r\n    for (const stop of stops) {\r\n        gradient.addColorStop(stop.offset, stop.color);\r\n    }\r\n    \r\n    return gradient;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TRANSFORMS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Execute drawing with rotation around a point\r\n */\r\nexport function withRotation(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    angle: number,\r\n    draw: () => void\r\n): void {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(angle);\r\n    ctx.translate(-x, -y);\r\n    draw();\r\n    ctx.restore();\r\n}\r\n\r\n/**\r\n * Execute drawing with scale around a point\r\n */\r\nexport function withScale(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    scaleX: number,\r\n    scaleY: number,\r\n    draw: () => void\r\n): void {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.scale(scaleX, scaleY);\r\n    ctx.translate(-x, -y);\r\n    draw();\r\n    ctx.restore();\r\n}\r\n\r\n/**\r\n * Execute drawing with alpha\r\n */\r\nexport function withAlpha(\r\n    ctx: Context2D,\r\n    alpha: number,\r\n    draw: () => void\r\n): void {\r\n    const prevAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = alpha;\r\n    draw();\r\n    ctx.globalAlpha = prevAlpha;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CLIPPING\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Execute drawing with rectangular clip region\r\n */\r\nexport function withClip(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    draw: () => void\r\n): void {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.rect(x, y, w, h);\r\n    ctx.clip();\r\n    draw();\r\n    ctx.restore();\r\n}\r\n\r\n/**\r\n * Execute drawing with circular clip region\r\n */\r\nexport function withCircularClip(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    radius: number,\r\n    draw: () => void\r\n): void {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n    ctx.clip();\r\n    draw();\r\n    ctx.restore();\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// PATTERNS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Draw stipple dots (for cartographic effect)\r\n */\r\nexport function drawStipple(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    density: number,\r\n    color: string,\r\n    dotSize: number = 1\r\n): void {\r\n    ctx.fillStyle = color;\r\n    \r\n    const count = Math.floor(width * height * density);\r\n    \r\n    for (let i = 0; i < count; i++) {\r\n        const dx = Math.random() * width;\r\n        const dy = Math.random() * height;\r\n        ctx.fillRect(x + dx, y + dy, dotSize, dotSize);\r\n    }\r\n}\r\n\r\n/**\r\n * Draw hatching lines (for elevation effect)\r\n */\r\nexport function drawHatching(\r\n    ctx: Context2D,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    spacing: number,\r\n    angle: number,\r\n    color: string,\r\n    lineWidth: number = 0.5\r\n): void {\r\n    ctx.save();\r\n    ctx.strokeStyle = color;\r\n    ctx.lineWidth = lineWidth;\r\n    \r\n    ctx.beginPath();\r\n    ctx.rect(x, y, width, height);\r\n    ctx.clip();\r\n    \r\n    const cos = Math.cos(angle);\r\n    const sin = Math.sin(angle);\r\n    const diagonal = Math.sqrt(width * width + height * height);\r\n    \r\n    for (let d = -diagonal; d < diagonal; d += spacing) {\r\n        const startX = x + width / 2 + d * cos - diagonal * sin;\r\n        const startY = y + height / 2 + d * sin + diagonal * cos;\r\n        const endX = x + width / 2 + d * cos + diagonal * sin;\r\n        const endY = y + height / 2 + d * sin - diagonal * cos;\r\n        \r\n        ctx.beginPath();\r\n        ctx.moveTo(startX, startY);\r\n        ctx.lineTo(endX, endY);\r\n        ctx.stroke();\r\n    }\r\n    \r\n    ctx.restore();\r\n}\r\n","/**\r\n * Civil Zones - Camera System\r\n * Handles viewport positioning, zoom, and screen-to-world coordinate conversion\r\n */\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TYPES\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport interface Camera {\r\n    x: number;      // World X position (center of viewport)\r\n    y: number;      // World Y position (center of viewport)\r\n    z: number;      // Zoom level (1.0 = 100%)\r\n}\r\n\r\nexport interface Viewport {\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport interface TileRange {\r\n    startCol: number;\r\n    endCol: number;\r\n    startRow: number;\r\n    endRow: number;\r\n}\r\n\r\nexport interface CameraConfig {\r\n    minZoom: number;\r\n    maxZoom: number;\r\n    zoomSpeed: number;\r\n    panSpeed: number;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// DEFAULT CONFIGURATION\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport const DEFAULT_CAMERA_CONFIG: CameraConfig = {\r\n    minZoom: 0.5,\r\n    maxZoom: 3.0,\r\n    zoomSpeed: 0.1,\r\n    panSpeed: 10\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CAMERA CREATION\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Create a new camera centered on a position\r\n */\r\nexport function createCamera(x: number = 0, y: number = 0, zoom: number = 1.0): Camera {\r\n    return { x, y, z: zoom };\r\n}\r\n\r\n/**\r\n * Create camera centered on map\r\n */\r\nexport function createCenteredCamera(\r\n    mapWidth: number,\r\n    mapHeight: number,\r\n    tileSize: number,\r\n    zoom: number = 1.0\r\n): Camera {\r\n    return {\r\n        x: (mapWidth * tileSize) / 2,\r\n        y: (mapHeight * tileSize) / 2,\r\n        z: zoom\r\n    };\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// COORDINATE CONVERSION\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Convert screen coordinates to world coordinates\r\n */\r\nexport function screenToWorld(\r\n    screenX: number,\r\n    screenY: number,\r\n    camera: Camera,\r\n    viewport: Viewport\r\n): { x: number; y: number } {\r\n    const worldX = camera.x + (screenX - viewport.width / 2) / camera.z;\r\n    const worldY = camera.y + (screenY - viewport.height / 2) / camera.z;\r\n    \r\n    return { x: worldX, y: worldY };\r\n}\r\n\r\n/**\r\n * Convert world coordinates to screen coordinates\r\n */\r\nexport function worldToScreen(\r\n    worldX: number,\r\n    worldY: number,\r\n    camera: Camera,\r\n    viewport: Viewport\r\n): { x: number; y: number } {\r\n    const screenX = viewport.width / 2 + (worldX - camera.x) * camera.z;\r\n    const screenY = viewport.height / 2 + (worldY - camera.y) * camera.z;\r\n    \r\n    return { x: screenX, y: screenY };\r\n}\r\n\r\n/**\r\n * Convert screen coordinates to tile coordinates\r\n */\r\nexport function screenToTile(\r\n    screenX: number,\r\n    screenY: number,\r\n    camera: Camera,\r\n    viewport: Viewport,\r\n    tileSize: number\r\n): { x: number; y: number } {\r\n    const world = screenToWorld(screenX, screenY, camera, viewport);\r\n    \r\n    return {\r\n        x: Math.floor(world.x / tileSize),\r\n        y: Math.floor(world.y / tileSize)\r\n    };\r\n}\r\n\r\n/**\r\n * Convert tile coordinates to screen coordinates (tile center)\r\n */\r\nexport function tileToScreen(\r\n    tileX: number,\r\n    tileY: number,\r\n    camera: Camera,\r\n    viewport: Viewport,\r\n    tileSize: number\r\n): { x: number; y: number } {\r\n    const worldX = tileX * tileSize + tileSize / 2;\r\n    const worldY = tileY * tileSize + tileSize / 2;\r\n    \r\n    return worldToScreen(worldX, worldY, camera, viewport);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// VISIBLE TILE RANGE\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Calculate the range of tiles visible in the viewport\r\n */\r\nexport function getVisibleTileRange(\r\n    camera: Camera,\r\n    viewport: Viewport,\r\n    tileSize: number,\r\n    mapWidth: number,\r\n    mapHeight: number\r\n): TileRange {\r\n    // Calculate world bounds of viewport\r\n    const halfWidth = (viewport.width / camera.z) / 2;\r\n    const halfHeight = (viewport.height / camera.z) / 2;\r\n    \r\n    // Convert to tile coordinates with padding\r\n    const startCol = Math.max(0, Math.floor((camera.x - halfWidth) / tileSize));\r\n    const endCol = Math.min(mapWidth, Math.ceil((camera.x + halfWidth) / tileSize));\r\n    const startRow = Math.max(0, Math.floor((camera.y - halfHeight) / tileSize));\r\n    const endRow = Math.min(mapHeight, Math.ceil((camera.y + halfHeight) / tileSize));\r\n    \r\n    return { startCol, endCol, startRow, endRow };\r\n}\r\n\r\n/**\r\n * Check if a tile is visible in the viewport\r\n */\r\nexport function isTileVisible(\r\n    tileX: number,\r\n    tileY: number,\r\n    camera: Camera,\r\n    viewport: Viewport,\r\n    tileSize: number\r\n): boolean {\r\n    const halfWidth = (viewport.width / camera.z) / 2;\r\n    const halfHeight = (viewport.height / camera.z) / 2;\r\n    \r\n    const tileLeft = tileX * tileSize;\r\n    const tileRight = tileLeft + tileSize;\r\n    const tileTop = tileY * tileSize;\r\n    const tileBottom = tileTop + tileSize;\r\n    \r\n    const viewLeft = camera.x - halfWidth;\r\n    const viewRight = camera.x + halfWidth;\r\n    const viewTop = camera.y - halfHeight;\r\n    const viewBottom = camera.y + halfHeight;\r\n    \r\n    return !(tileRight < viewLeft || tileLeft > viewRight ||\r\n             tileBottom < viewTop || tileTop > viewBottom);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CAMERA MOVEMENT\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Pan camera by screen delta\r\n */\r\nexport function panCamera(\r\n    camera: Camera,\r\n    deltaX: number,\r\n    deltaY: number\r\n): Camera {\r\n    return {\r\n        ...camera,\r\n        x: camera.x + deltaX / camera.z,\r\n        y: camera.y + deltaY / camera.z\r\n    };\r\n}\r\n\r\n/**\r\n * Center camera on a world position\r\n */\r\nexport function centerCameraOn(\r\n    camera: Camera,\r\n    worldX: number,\r\n    worldY: number\r\n): Camera {\r\n    return {\r\n        ...camera,\r\n        x: worldX,\r\n        y: worldY\r\n    };\r\n}\r\n\r\n/**\r\n * Center camera on a tile\r\n */\r\nexport function centerCameraOnTile(\r\n    camera: Camera,\r\n    tileX: number,\r\n    tileY: number,\r\n    tileSize: number\r\n): Camera {\r\n    return {\r\n        ...camera,\r\n        x: tileX * tileSize + tileSize / 2,\r\n        y: tileY * tileSize + tileSize / 2\r\n    };\r\n}\r\n\r\n/**\r\n * Zoom camera around a point\r\n */\r\nexport function zoomCamera(\r\n    camera: Camera,\r\n    delta: number,\r\n    config: CameraConfig = DEFAULT_CAMERA_CONFIG\r\n): Camera {\r\n    const newZoom = Math.max(\r\n        config.minZoom,\r\n        Math.min(config.maxZoom, camera.z + delta * config.zoomSpeed)\r\n    );\r\n    \r\n    return {\r\n        ...camera,\r\n        z: newZoom\r\n    };\r\n}\r\n\r\n/**\r\n * Zoom camera centered on a screen position\r\n */\r\nexport function zoomCameraAt(\r\n    camera: Camera,\r\n    screenX: number,\r\n    screenY: number,\r\n    viewport: Viewport,\r\n    delta: number,\r\n    config: CameraConfig = DEFAULT_CAMERA_CONFIG\r\n): Camera {\r\n    // Get world position under cursor before zoom\r\n    const worldBefore = screenToWorld(screenX, screenY, camera, viewport);\r\n    \r\n    // Apply zoom\r\n    const newZoom = Math.max(\r\n        config.minZoom,\r\n        Math.min(config.maxZoom, camera.z + delta * config.zoomSpeed)\r\n    );\r\n    \r\n    // Get world position under cursor after zoom (with new zoom but old camera pos)\r\n    const tempCamera = { ...camera, z: newZoom };\r\n    const worldAfter = screenToWorld(screenX, screenY, tempCamera, viewport);\r\n    \r\n    // Adjust camera position to keep world point under cursor\r\n    return {\r\n        x: camera.x + (worldBefore.x - worldAfter.x),\r\n        y: camera.y + (worldBefore.y - worldAfter.y),\r\n        z: newZoom\r\n    };\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CAMERA CONSTRAINTS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Clamp camera to map bounds\r\n */\r\nexport function clampCameraToMap(\r\n    camera: Camera,\r\n    viewport: Viewport,\r\n    mapWidth: number,\r\n    mapHeight: number,\r\n    tileSize: number\r\n): Camera {\r\n    const worldWidth = mapWidth * tileSize;\r\n    const worldHeight = mapHeight * tileSize;\r\n    \r\n    const halfViewWidth = (viewport.width / camera.z) / 2;\r\n    const halfViewHeight = (viewport.height / camera.z) / 2;\r\n    \r\n    // Clamp X\r\n    let x = camera.x;\r\n    if (halfViewWidth * 2 >= worldWidth) {\r\n        // View is wider than map - center it\r\n        x = worldWidth / 2;\r\n    } else {\r\n        x = Math.max(halfViewWidth, Math.min(worldWidth - halfViewWidth, x));\r\n    }\r\n    \r\n    // Clamp Y\r\n    let y = camera.y;\r\n    if (halfViewHeight * 2 >= worldHeight) {\r\n        // View is taller than map - center it\r\n        y = worldHeight / 2;\r\n    } else {\r\n        y = Math.max(halfViewHeight, Math.min(worldHeight - halfViewHeight, y));\r\n    }\r\n    \r\n    return { x, y, z: camera.z };\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// CANVAS TRANSFORM HELPERS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Apply camera transform to canvas context\r\n */\r\nexport function applyCameraTransform(\r\n    ctx: CanvasRenderingContext2D,\r\n    camera: Camera,\r\n    viewport: Viewport\r\n): void {\r\n    ctx.save();\r\n    ctx.translate(viewport.width / 2, viewport.height / 2);\r\n    ctx.scale(camera.z, camera.z);\r\n    ctx.translate(-camera.x, -camera.y);\r\n}\r\n\r\n/**\r\n * Restore canvas context after camera transform\r\n */\r\nexport function restoreCameraTransform(ctx: CanvasRenderingContext2D): void {\r\n    ctx.restore();\r\n}\r\n","/**\r\n * Civil Zones - Effects & Particles System\r\n * Handles visual effects like dust, wood chips, water splashes, etc.\r\n */\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// TYPES\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\nexport interface Particle {\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    life: number;\r\n    maxLife: number;\r\n    color: string;\r\n    size: number;\r\n    active: boolean;\r\n}\r\n\r\nexport interface Effect {\r\n    type: EffectType;\r\n    x: number;          // Tile X position\r\n    y: number;          // Tile Y position\r\n    start: number;      // Start time (performance.now())\r\n    duration: number;   // Duration in ms\r\n    data?: unknown;     // Effect-specific data\r\n}\r\n\r\nexport type EffectType = \r\n    | 'woodchips'\r\n    | 'dust'\r\n    | 'water_splash'\r\n    | 'impact_stars'\r\n    | 'smoke'\r\n    | 'sparkle';\r\n\r\nexport interface WoodChipData {\r\n    chips: Array<{ angle: number; speed: number }>;\r\n}\r\n\r\nexport interface DustData {\r\n    puffs: Array<{ angle: number; radius: number }>;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// PARTICLE POOL\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Object pool for particles to avoid GC\r\n */\r\nexport class ParticlePool {\r\n    private pool: Particle[] = [];\r\n    private maxSize: number;\r\n    \r\n    constructor(initialSize: number = 500, maxSize: number = 1000) {\r\n        this.maxSize = maxSize;\r\n        \r\n        // Pre-allocate particles\r\n        for (let i = 0; i < initialSize; i++) {\r\n            this.pool.push(this.createParticle());\r\n        }\r\n    }\r\n    \r\n    private createParticle(): Particle {\r\n        return {\r\n            x: 0,\r\n            y: 0,\r\n            vx: 0,\r\n            vy: 0,\r\n            life: 0,\r\n            maxLife: 0,\r\n            color: '',\r\n            size: 1,\r\n            active: false\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get a particle from the pool\r\n     */\r\n    get(\r\n        x: number,\r\n        y: number,\r\n        vx: number,\r\n        vy: number,\r\n        life: number,\r\n        color: string,\r\n        size: number = 2\r\n    ): Particle {\r\n        // Find inactive particle\r\n        for (const p of this.pool) {\r\n            if (!p.active) {\r\n                p.x = x;\r\n                p.y = y;\r\n                p.vx = vx;\r\n                p.vy = vy;\r\n                p.life = life;\r\n                p.maxLife = life;\r\n                p.color = color;\r\n                p.size = size;\r\n                p.active = true;\r\n                return p;\r\n            }\r\n        }\r\n        \r\n        // Pool exhausted - create new if under max\r\n        if (this.pool.length < this.maxSize) {\r\n            const p = this.createParticle();\r\n            p.x = x;\r\n            p.y = y;\r\n            p.vx = vx;\r\n            p.vy = vy;\r\n            p.life = life;\r\n            p.maxLife = life;\r\n            p.color = color;\r\n            p.size = size;\r\n            p.active = true;\r\n            this.pool.push(p);\r\n            return p;\r\n        }\r\n        \r\n        // Pool at max - return oldest active particle (reuse it)\r\n        const oldest = this.pool[0];\r\n        oldest.x = x;\r\n        oldest.y = y;\r\n        oldest.vx = vx;\r\n        oldest.vy = vy;\r\n        oldest.life = life;\r\n        oldest.maxLife = life;\r\n        oldest.color = color;\r\n        oldest.size = size;\r\n        oldest.active = true;\r\n        return oldest;\r\n    }\r\n    \r\n    /**\r\n     * Update all active particles\r\n     */\r\n    update(deltaTime: number, gravity: number = 0.1): void {\r\n        for (const p of this.pool) {\r\n            if (p.active) {\r\n                p.x += p.vx * deltaTime;\r\n                p.y += p.vy * deltaTime;\r\n                p.vy += gravity * deltaTime;\r\n                p.life -= deltaTime;\r\n                \r\n                if (p.life <= 0) {\r\n                    p.active = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get all active particles\r\n     */\r\n    getActive(): Particle[] {\r\n        return this.pool.filter(p => p.active);\r\n    }\r\n    \r\n    /**\r\n     * Clear all particles\r\n     */\r\n    clear(): void {\r\n        for (const p of this.pool) {\r\n            p.active = false;\r\n        }\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// EFFECT MANAGER\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Manages timed visual effects\r\n */\r\nexport class EffectManager {\r\n    private effects: Effect[] = [];\r\n    \r\n    /**\r\n     * Add a new effect\r\n     */\r\n    add(type: EffectType, tileX: number, tileY: number, duration: number, data?: unknown): void {\r\n        this.effects.push({\r\n            type,\r\n            x: tileX,\r\n            y: tileY,\r\n            start: performance.now(),\r\n            duration,\r\n            data\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Add wood chips burst effect\r\n     */\r\n    addWoodChips(tileX: number, tileY: number): void {\r\n        const chips: WoodChipData['chips'] = [];\r\n        \r\n        for (let i = 0; i < 8; i++) {\r\n            const angle = (Math.PI * 2) * (i / 8) + Math.random() * 0.3;\r\n            const speed = 0.5 + Math.random() * 0.7;\r\n            chips.push({ angle, speed });\r\n        }\r\n        \r\n        this.add('woodchips', tileX, tileY, 600, { chips });\r\n    }\r\n    \r\n    /**\r\n     * Add dust cloud effect\r\n     */\r\n    addDust(tileX: number, tileY: number): void {\r\n        const puffs: DustData['puffs'] = [];\r\n        \r\n        for (let i = 0; i < 6; i++) {\r\n            const angle = (Math.PI * 2) * (i / 6);\r\n            const radius = 0.18 + (i % 2) * 0.06;\r\n            puffs.push({ angle, radius });\r\n        }\r\n        \r\n        this.add('dust', tileX, tileY, 9000, { puffs });\r\n    }\r\n    \r\n    /**\r\n     * Add water splash effect\r\n     */\r\n    addWaterSplash(tileX: number, tileY: number): void {\r\n        this.add('water_splash', tileX, tileY, 500);\r\n    }\r\n    \r\n    /**\r\n     * Add impact stars effect\r\n     */\r\n    addImpactStars(tileX: number, tileY: number): void {\r\n        this.add('impact_stars', tileX, tileY, 300);\r\n    }\r\n    \r\n    /**\r\n     * Update effects (remove expired)\r\n     */\r\n    update(): void {\r\n        const now = performance.now();\r\n        this.effects = this.effects.filter(\r\n            e => (now - e.start) < e.duration\r\n        );\r\n    }\r\n    \r\n    /**\r\n     * Get all active effects\r\n     */\r\n    getActive(): Effect[] {\r\n        return this.effects;\r\n    }\r\n    \r\n    /**\r\n     * Get effect progress (0.0 - 1.0)\r\n     */\r\n    getProgress(effect: Effect): number {\r\n        const elapsed = performance.now() - effect.start;\r\n        return Math.min(1.0, elapsed / effect.duration);\r\n    }\r\n    \r\n    /**\r\n     * Clear all effects\r\n     */\r\n    clear(): void {\r\n        this.effects = [];\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n// EFFECT RENDERING HELPERS\r\n// ═══════════════════════════════════════════════════════════════════════════════\r\n\r\n/**\r\n * Calculate wood chip position at time\r\n */\r\nexport function getWoodChipPosition(\r\n    chip: { angle: number; speed: number },\r\n    progress: number,\r\n    tileSize: number\r\n): { x: number; y: number; alpha: number } {\r\n    const distance = chip.speed * progress * tileSize;\r\n    const gravity = progress * progress * tileSize * 0.3;\r\n    \r\n    return {\r\n        x: Math.cos(chip.angle) * distance,\r\n        y: Math.sin(chip.angle) * distance + gravity,\r\n        alpha: 1 - progress\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate dust puff size at time\r\n */\r\nexport function getDustPuffSize(\r\n    puff: { angle: number; radius: number },\r\n    progress: number,\r\n    tileSize: number\r\n): { x: number; y: number; size: number; alpha: number } {\r\n    const expand = Math.sin(progress * Math.PI) * 0.5;\r\n    const currentRadius = (puff.radius + expand) * tileSize;\r\n    \r\n    return {\r\n        x: Math.cos(puff.angle) * currentRadius,\r\n        y: Math.sin(puff.angle) * currentRadius,\r\n        size: tileSize * (0.2 + expand * 0.3),\r\n        alpha: (1 - progress) * 0.6\r\n    };\r\n}\r\n\r\n/**\r\n * Get impact star positions\r\n */\r\nexport function getImpactStarPositions(\r\n    progress: number,\r\n    count: number = 3\r\n): Array<{ x: number; y: number; size: number }> {\r\n    const stars: Array<{ x: number; y: number; size: number }> = [];\r\n    \r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2) * (i / count) + progress * 2;\r\n        const distance = progress * 20;\r\n        const size = (1 - progress) * 4;\r\n        \r\n        stars.push({\r\n            x: Math.cos(angle) * distance,\r\n            y: Math.sin(angle) * distance,\r\n            size\r\n        });\r\n    }\r\n    \r\n    return stars;\r\n}\r\n","/**\r\n * Civil Zones - UI Types\r\n * Type definitions for UI components\r\n */\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// TOAST NOTIFICATIONS\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Toast notification options */\r\nexport interface ToastOptions {\r\n    duration?: number;      // Duration in ms (default: 2000)\r\n    isError?: boolean;      // Red background for errors\r\n    persistent?: boolean;   // Don't auto-hide\r\n}\r\n\r\n/** Toast notification state */\r\nexport interface ToastState {\r\n    message: string;\r\n    isVisible: boolean;\r\n    isError: boolean;\r\n    timeoutId: number | null;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// MENUS\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Menu panel identifiers */\r\nexport type MenuPanelId = \r\n    | 'building-menu-panel'\r\n    | 'industrial-menu-panel'\r\n    | 'commercial-menu-panel'\r\n    | 'storage-menu-panel'\r\n    | 'special-menu-panel'\r\n    | 'road-menu-panel'\r\n    | 'milestone-menu-panel'\r\n    | 'stats-menu'\r\n    | 'log-modal';\r\n\r\n/** Menu state */\r\nexport interface MenuState {\r\n    activeMenu: MenuPanelId | null;\r\n    selectedLevel: number;\r\n    selectedBuilding: string | null;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// HUD ELEMENTS\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Resource display configuration */\r\nexport interface ResourceDisplay {\r\n    elementId: string;\r\n    icon: string;\r\n    getValue: () => number;\r\n    format?: (value: number) => string;\r\n    showInWander?: boolean;\r\n    showInCity?: boolean;\r\n}\r\n\r\n/** Stats bar configuration */\r\nexport interface StatsConfig {\r\n    population: ResourceDisplay;\r\n    food: ResourceDisplay;\r\n    wood: ResourceDisplay;\r\n    metal: ResourceDisplay;\r\n    stone: ResourceDisplay;\r\n    gold: ResourceDisplay;\r\n    water: ResourceDisplay;\r\n    thirst: ResourceDisplay;\r\n    inventory: ResourceDisplay;\r\n}\r\n\r\n/** HUD visibility state */\r\nexport interface HUDState {\r\n    showPopulation: boolean;\r\n    showResources: boolean;\r\n    showWater: boolean;\r\n    showYear: boolean;\r\n    showThirst: boolean;\r\n    showInventory: boolean;\r\n    showRCI: boolean;\r\n    showNeeds: boolean;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// NEEDS WARNING PANEL\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Need type */\r\nexport type NeedType = 'housing' | 'water' | 'food' | 'jobs' | 'paths';\r\n\r\n/** Need warning */\r\nexport interface NeedWarning {\r\n    type: NeedType;\r\n    message: string;\r\n    severity: 'critical' | 'warning' | 'info';\r\n    color: string;\r\n}\r\n\r\n/** Needs panel state */\r\nexport interface NeedsPanelState {\r\n    visible: boolean;\r\n    warnings: NeedWarning[];\r\n    satisfaction: number;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LORE SYSTEM\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Lore event type */\r\nexport type LoreEventType = \r\n    | 'GAME_START'\r\n    | 'FIRST_WELL'\r\n    | 'FIRST_HUT'\r\n    | 'FIRST_HUNT'\r\n    | 'FIRST_ROAD'\r\n    | 'SETTLEMENT'\r\n    | 'FIRST_TRADE'\r\n    | 'FLOOD_WARNING';\r\n\r\n/** Lore event data */\r\nexport interface LoreEvent {\r\n    id: LoreEventType;\r\n    title: string;\r\n    text: string;\r\n    illustration: string;\r\n}\r\n\r\n/** Lore popup state */\r\nexport interface LoreState {\r\n    enabled: boolean;\r\n    seenEvents: Set<LoreEventType>;\r\n    currentEvent: LoreEvent | null;\r\n    isVisible: boolean;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOGGING\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Log entry type */\r\nexport type LogLevel = 'LOG' | 'WARN' | 'ERROR' | 'INFO';\r\n\r\n/** Log entry */\r\nexport interface LogEntry {\r\n    timestamp: string;\r\n    level: LogLevel;\r\n    message: string;\r\n}\r\n\r\n/** Log view type */\r\nexport type LogViewType = 'player' | 'technical';\r\n\r\n/** Log state */\r\nexport interface LogState {\r\n    playerLog: LogEntry[];\r\n    technicalLog: LogEntry[];\r\n    currentView: LogViewType;\r\n    maxEntries: number;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// VIEW MODES\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Game view mode */\r\nexport type ViewMode = 'NORMAL' | 'DESIRABILITY' | 'BIRDSEYE' | 'POL' | 'ELEVATION';\r\n\r\n/** View mode info */\r\nexport interface ViewModeInfo {\r\n    mode: ViewMode;\r\n    icon: string;\r\n    title: string;\r\n    description: string;\r\n}\r\n\r\n/** Available view modes */\r\nexport const VIEW_MODES: ViewModeInfo[] = [\r\n    { mode: 'NORMAL', icon: '👁️', title: 'Normal View', description: 'Standard game view' },\r\n    { mode: 'DESIRABILITY', icon: '🔥', title: 'Desirability Heatmap', description: 'Shows land value' },\r\n    { mode: 'BIRDSEYE', icon: '🎨', title: 'Birds Eye View', description: 'Clean view without UI' },\r\n    { mode: 'POL', icon: '☢️', title: 'Pollution View', description: 'Shows pollution levels' }\r\n];\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// UI CONFIGURATION\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Need type colors */\r\nexport const NEED_COLORS: Record<NeedType, string> = {\r\n    housing: '#FF6B6B',\r\n    water: '#4ECDC4',\r\n    food: '#FFD93D',\r\n    jobs: '#6BCF7F',\r\n    paths: '#A78BFA'\r\n};\r\n\r\n/** Default toast duration */\r\nexport const DEFAULT_TOAST_DURATION = 2000;\r\n\r\n/** Max log entries */\r\nexport const MAX_PLAYER_LOG_ENTRIES = 200;\r\nexport const MAX_TECHNICAL_LOG_ENTRIES = 500;\r\n","/**\r\n * Civil Zones - Toast Notification System\r\n * Shows temporary messages to the player\r\n */\r\n\r\nimport type { ToastOptions, ToastState } from './types.js';\r\nimport { DEFAULT_TOAST_DURATION, MAX_PLAYER_LOG_ENTRIES, MAX_TECHNICAL_LOG_ENTRIES } from './types.js';\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// TOAST STATE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nlet toastState: ToastState = {\r\n    message: '',\r\n    isVisible: false,\r\n    isError: false,\r\n    timeoutId: null\r\n};\r\n\r\nlet toastElement: HTMLElement | null = null;\r\n\r\n// Log storage (for integration with game logs)\r\nlet playerLog: string[] = [];\r\nlet technicalLog: string[] = [];\r\nlet currentYear = 0;\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// INITIALIZATION\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Initialize toast system with DOM element */\r\nexport function initToast(elementId: string = 'toast'): void {\r\n    toastElement = document.getElementById(elementId);\r\n    if (!toastElement) {\r\n        console.warn(`Toast element with id '${elementId}' not found`);\r\n    }\r\n}\r\n\r\n/** Set current game year for log timestamps */\r\nexport function setCurrentYear(year: number): void {\r\n    currentYear = year;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// TOAST DISPLAY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Show a toast notification */\r\nexport function showToast(message: string, options: ToastOptions = {}): void {\r\n    const {\r\n        duration = DEFAULT_TOAST_DURATION,\r\n        isError = false,\r\n        persistent = false\r\n    } = options;\r\n\r\n    // Clear existing timeout\r\n    if (toastState.timeoutId !== null) {\r\n        clearTimeout(toastState.timeoutId);\r\n        toastState.timeoutId = null;\r\n    }\r\n\r\n    // Update state\r\n    toastState.message = message;\r\n    toastState.isVisible = true;\r\n    toastState.isError = isError;\r\n\r\n    // Update DOM\r\n    if (toastElement) {\r\n        toastElement.innerText = message;\r\n        toastElement.style.opacity = '1';\r\n        toastElement.style.background = isError \r\n            ? '#F44336' \r\n            : 'rgba(0, 0, 0, 0.85)';\r\n    }\r\n\r\n    // Add to logs\r\n    addToPlayerLog(message);\r\n    addToTechnicalLog(message);\r\n\r\n    // Auto-hide unless persistent\r\n    if (!persistent) {\r\n        toastState.timeoutId = window.setTimeout(() => {\r\n            hideToast();\r\n        }, duration);\r\n    }\r\n}\r\n\r\n/** Hide the toast */\r\nexport function hideToast(): void {\r\n    toastState.isVisible = false;\r\n    toastState.timeoutId = null;\r\n    \r\n    if (toastElement) {\r\n        toastElement.style.opacity = '0';\r\n    }\r\n}\r\n\r\n/** Show error toast */\r\nexport function showError(message: string, duration: number = DEFAULT_TOAST_DURATION): void {\r\n    showToast(message, { isError: true, duration });\r\n}\r\n\r\n/** Show success toast (green-tinted message) */\r\nexport function showSuccess(message: string, duration: number = DEFAULT_TOAST_DURATION): void {\r\n    showToast(`✅ ${message}`, { duration });\r\n}\r\n\r\n/** Show warning toast */\r\nexport function showWarning(message: string, duration: number = DEFAULT_TOAST_DURATION): void {\r\n    showToast(`⚠️ ${message}`, { duration });\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOGGING\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Add message to player log */\r\nfunction addToPlayerLog(message: string): void {\r\n    const timestamp = `[Y${currentYear}]`;\r\n    playerLog.push(`${timestamp} ${message}`);\r\n    \r\n    // Trim if too long\r\n    while (playerLog.length > MAX_PLAYER_LOG_ENTRIES) {\r\n        playerLog.shift();\r\n    }\r\n}\r\n\r\n/** Add message to technical log */\r\nfunction addToTechnicalLog(message: string): void {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    technicalLog.push(`[${timestamp}] ${message}`);\r\n    \r\n    // Trim if too long\r\n    while (technicalLog.length > MAX_TECHNICAL_LOG_ENTRIES) {\r\n        technicalLog.shift();\r\n    }\r\n}\r\n\r\n/** Get player log entries */\r\nexport function getPlayerLog(): string[] {\r\n    return [...playerLog];\r\n}\r\n\r\n/** Get technical log entries */\r\nexport function getTechnicalLog(): string[] {\r\n    return [...technicalLog];\r\n}\r\n\r\n/** Clear all logs */\r\nexport function clearLogs(): void {\r\n    playerLog = [];\r\n    technicalLog = [];\r\n}\r\n\r\n/** Set logs from external source (for game state restoration) */\r\nexport function setLogs(player: string[], technical: string[]): void {\r\n    playerLog = [...player];\r\n    technicalLog = [...technical];\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// UTILITY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Get current toast state */\r\nexport function getToastState(): ToastState {\r\n    return { ...toastState };\r\n}\r\n\r\n/** Check if toast is currently visible */\r\nexport function isToastVisible(): boolean {\r\n    return toastState.isVisible;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// TOAST CLASS (for object-oriented usage)\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport class ToastManager {\r\n    private element: HTMLElement | null = null;\r\n    private state: ToastState;\r\n    private playerLog: string[] = [];\r\n    private technicalLog: string[] = [];\r\n    private currentYear: number = 0;\r\n\r\n    constructor(elementId: string = 'toast') {\r\n        this.element = document.getElementById(elementId);\r\n        this.state = {\r\n            message: '',\r\n            isVisible: false,\r\n            isError: false,\r\n            timeoutId: null\r\n        };\r\n    }\r\n\r\n    setYear(year: number): void {\r\n        this.currentYear = year;\r\n    }\r\n\r\n    show(message: string, options: ToastOptions = {}): void {\r\n        const { duration = DEFAULT_TOAST_DURATION, isError = false, persistent = false } = options;\r\n\r\n        if (this.state.timeoutId !== null) {\r\n            clearTimeout(this.state.timeoutId);\r\n        }\r\n\r\n        this.state.message = message;\r\n        this.state.isVisible = true;\r\n        this.state.isError = isError;\r\n\r\n        if (this.element) {\r\n            this.element.innerText = message;\r\n            this.element.style.opacity = '1';\r\n            this.element.style.background = isError ? '#F44336' : 'rgba(0, 0, 0, 0.85)';\r\n        }\r\n\r\n        // Log the message\r\n        const playerTimestamp = `[Y${this.currentYear}]`;\r\n        this.playerLog.push(`${playerTimestamp} ${message}`);\r\n        if (this.playerLog.length > MAX_PLAYER_LOG_ENTRIES) this.playerLog.shift();\r\n\r\n        const techTimestamp = new Date().toLocaleTimeString();\r\n        this.technicalLog.push(`[${techTimestamp}] ${message}`);\r\n        if (this.technicalLog.length > MAX_TECHNICAL_LOG_ENTRIES) this.technicalLog.shift();\r\n\r\n        if (!persistent) {\r\n            this.state.timeoutId = window.setTimeout(() => this.hide(), duration);\r\n        }\r\n    }\r\n\r\n    hide(): void {\r\n        this.state.isVisible = false;\r\n        this.state.timeoutId = null;\r\n        if (this.element) {\r\n            this.element.style.opacity = '0';\r\n        }\r\n    }\r\n\r\n    error(message: string): void {\r\n        this.show(message, { isError: true });\r\n    }\r\n\r\n    success(message: string): void {\r\n        this.show(`✅ ${message}`);\r\n    }\r\n\r\n    warning(message: string): void {\r\n        this.show(`⚠️ ${message}`);\r\n    }\r\n\r\n    getPlayerLog(): string[] {\r\n        return [...this.playerLog];\r\n    }\r\n\r\n    getTechnicalLog(): string[] {\r\n        return [...this.technicalLog];\r\n    }\r\n}\r\n","/**\r\n * Civil Zones - Menu System\r\n * Handles building menus, stat menus, and modal dialogs\r\n */\r\n\r\nimport type { MenuPanelId, MenuState } from './types.js';\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// MENU STATE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nlet menuState: MenuState = {\r\n    activeMenu: null,\r\n    selectedLevel: 1,\r\n    selectedBuilding: null\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// MENU VISIBILITY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Show a menu panel by ID */\r\nexport function showMenu(menuId: MenuPanelId): void {\r\n    const panel = document.getElementById(menuId);\r\n    if (panel) {\r\n        panel.style.display = 'block';\r\n        menuState.activeMenu = menuId;\r\n    }\r\n}\r\n\r\n/** Hide a menu panel by ID */\r\nexport function hideMenu(menuId: MenuPanelId): void {\r\n    const panel = document.getElementById(menuId);\r\n    if (panel) {\r\n        panel.style.display = 'none';\r\n        if (menuState.activeMenu === menuId) {\r\n            menuState.activeMenu = null;\r\n        }\r\n    }\r\n}\r\n\r\n/** Hide all menus */\r\nexport function hideAllMenus(): void {\r\n    const menuIds: MenuPanelId[] = [\r\n        'building-menu-panel',\r\n        'industrial-menu-panel',\r\n        'commercial-menu-panel',\r\n        'storage-menu-panel',\r\n        'special-menu-panel',\r\n        'road-menu-panel',\r\n        'milestone-menu-panel',\r\n        'stats-menu',\r\n        'log-modal'\r\n    ];\r\n    \r\n    for (const menuId of menuIds) {\r\n        hideMenu(menuId);\r\n    }\r\n    menuState.activeMenu = null;\r\n}\r\n\r\n/** Toggle menu visibility */\r\nexport function toggleMenu(menuId: MenuPanelId): void {\r\n    if (menuState.activeMenu === menuId) {\r\n        hideMenu(menuId);\r\n    } else {\r\n        hideAllMenus();\r\n        showMenu(menuId);\r\n    }\r\n}\r\n\r\n/** Check if a menu is open */\r\nexport function isMenuOpen(menuId?: MenuPanelId): boolean {\r\n    if (menuId) {\r\n        return menuState.activeMenu === menuId;\r\n    }\r\n    return menuState.activeMenu !== null;\r\n}\r\n\r\n/** Get active menu */\r\nexport function getActiveMenu(): MenuPanelId | null {\r\n    return menuState.activeMenu;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// BUILDING LEVEL SELECTION\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Set selected building level */\r\nexport function setSelectedLevel(level: number): void {\r\n    menuState.selectedLevel = level;\r\n}\r\n\r\n/** Get selected building level */\r\nexport function getSelectedLevel(): number {\r\n    return menuState.selectedLevel;\r\n}\r\n\r\n/** Set selected building type */\r\nexport function setSelectedBuilding(buildingId: string | null): void {\r\n    menuState.selectedBuilding = buildingId;\r\n}\r\n\r\n/** Get selected building type */\r\nexport function getSelectedBuilding(): string | null {\r\n    return menuState.selectedBuilding;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// CARD SELECTION\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Update card selection visual in a grid */\r\nexport function updateCardSelection(gridSelector: string, selectedCardId: string): void {\r\n    const cards = document.querySelectorAll(`${gridSelector} .level-card`);\r\n    cards.forEach(card => {\r\n        card.classList.remove('selected');\r\n    });\r\n    \r\n    const selectedCard = document.getElementById(selectedCardId);\r\n    if (selectedCard && !selectedCard.classList.contains('level-locked')) {\r\n        selectedCard.classList.add('selected');\r\n    }\r\n}\r\n\r\n/** Check if a card is locked */\r\nexport function isCardLocked(cardId: string): boolean {\r\n    const card = document.getElementById(cardId);\r\n    return card?.classList.contains('level-locked') ?? true;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// OVERLAY MANAGEMENT\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Show an overlay by ID */\r\nexport function showOverlay(overlayId: string): void {\r\n    const overlay = document.getElementById(overlayId);\r\n    if (overlay) {\r\n        overlay.style.display = 'block';\r\n    }\r\n}\r\n\r\n/** Hide an overlay by ID */\r\nexport function hideOverlay(overlayId: string): void {\r\n    const overlay = document.getElementById(overlayId);\r\n    if (overlay) {\r\n        overlay.style.display = 'none';\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// MODAL DIALOGS\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Show a modal with content */\r\nexport function showModal(\r\n    modalId: string, \r\n    title: string, \r\n    content: string,\r\n    overlayId?: string\r\n): void {\r\n    const modal = document.getElementById(modalId);\r\n    if (!modal) return;\r\n    \r\n    const titleEl = modal.querySelector('.modal-title, h3, h2');\r\n    const contentEl = modal.querySelector('.modal-content, .content');\r\n    \r\n    if (titleEl) titleEl.textContent = title;\r\n    if (contentEl) contentEl.innerHTML = content;\r\n    \r\n    modal.style.display = 'flex';\r\n    \r\n    if (overlayId) {\r\n        showOverlay(overlayId);\r\n    }\r\n}\r\n\r\n/** Hide a modal */\r\nexport function hideModal(modalId: string, overlayId?: string): void {\r\n    const modal = document.getElementById(modalId);\r\n    if (modal) {\r\n        modal.style.display = 'none';\r\n    }\r\n    \r\n    if (overlayId) {\r\n        hideOverlay(overlayId);\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// STATS MENU\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport interface StatsData {\r\n    year: number;\r\n    turn: number;\r\n    gameState: string;\r\n    population: number;\r\n    populationCap: number;\r\n    totalFoodCollected: number;\r\n    nomadsFound: number;\r\n    buildings: {\r\n        residential: number;\r\n        commercial: number;\r\n        industrial: number;\r\n        wells: number;\r\n        total: number;\r\n    };\r\n    avgResLevel: number;\r\n    unlockedLevels: number[];\r\n}\r\n\r\n/** Generate stats menu HTML */\r\nexport function generateStatsHTML(stats: StatsData): string {\r\n    let html = '';\r\n    \r\n    // Time & Progress\r\n    html += '<div style=\"margin-bottom:10px;\"><strong style=\"color:#81C784;\">⏱️ Progress</strong></div>';\r\n    html += `<div>Year: ${stats.year}</div>`;\r\n    html += `<div>Turns Played: ${stats.turn}</div>`;\r\n    html += `<div>Game Mode: ${stats.gameState}</div>`;\r\n    \r\n    // Population\r\n    if (stats.gameState === 'CITY') {\r\n        html += '<div style=\"margin: 15px 0 10px 0;\"><strong style=\"color:#FF7043;\">👥 Population</strong></div>';\r\n        html += `<div>Total Population: ${formatNumber(stats.population)}</div>`;\r\n        html += `<div>Population Capacity: ${formatNumber(stats.populationCap)}</div>`;\r\n        html += `<div>Residential Buildings: ${stats.buildings.residential}</div>`;\r\n        html += `<div>Average Res Level: ${stats.avgResLevel.toFixed(1)}</div>`;\r\n    }\r\n    \r\n    // Resources\r\n    html += '<div style=\"margin: 15px 0 10px 0;\"><strong style=\"color:#4CAF50;\">🌾 Resources</strong></div>';\r\n    html += `<div>Food Collected: ${formatNumber(stats.totalFoodCollected)}</div>`;\r\n    if (stats.gameState === 'WANDER') {\r\n        html += `<div>Nomads Found: ${stats.nomadsFound}</div>`;\r\n    }\r\n    \r\n    // Buildings\r\n    if (stats.gameState === 'CITY') {\r\n        html += '<div style=\"margin: 15px 0 10px 0;\"><strong style=\"color:#2196F3;\">🏗️ Buildings</strong></div>';\r\n        html += `<div>Residential: ${stats.buildings.residential}</div>`;\r\n        html += `<div>Commercial: ${stats.buildings.commercial}</div>`;\r\n        html += `<div>Industrial: ${stats.buildings.industrial}</div>`;\r\n        html += `<div>Wells: ${stats.buildings.wells}</div>`;\r\n        html += `<div>Total Buildings: ${stats.buildings.total}</div>`;\r\n    }\r\n    \r\n    // Unlocks\r\n    html += '<div style=\"margin: 15px 0 10px 0;\"><strong style=\"color:#9C27B0;\">🔓 Progress</strong></div>';\r\n    html += `<div>Unlocked Res Levels: ${stats.unlockedLevels.length}</div>`;\r\n    html += `<div>Highest Unlocked: Level ${Math.max(...stats.unlockedLevels, 0)}</div>`;\r\n    \r\n    return html;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// UTILITY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Format number with K/M/B suffixes */\r\nfunction formatNumber(num: number): string {\r\n    if (num >= 1e18) return (num / 1e18).toFixed(1) + 'Qi';\r\n    if (num >= 1e15) return (num / 1e15).toFixed(1) + 'Q';\r\n    if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';\r\n    if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';\r\n    if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';\r\n    if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';\r\n    return Math.floor(num).toString();\r\n}\r\n\r\n/** Get menu state */\r\nexport function getMenuState(): MenuState {\r\n    return { ...menuState };\r\n}\r\n","/**\r\n * Civil Zones - HUD (Heads-Up Display) System\r\n * Manages on-screen resource displays, stats, and status indicators\r\n */\r\n\r\nimport type { HUDState, NeedType, NeedWarning, NeedsPanelState } from './types.js';\r\nimport { NEED_COLORS } from './types.js';\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// HUD STATE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nlet hudState: HUDState = {\r\n    showPopulation: true,\r\n    showResources: true,\r\n    showWater: true,\r\n    showYear: true,\r\n    showThirst: false,\r\n    showInventory: false,\r\n    showRCI: true,\r\n    showNeeds: true\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// NUMBER FORMATTING\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Format number with K/M/B/T/Q/Qi suffixes */\r\nexport function formatNumber(num: number): string {\r\n    if (num >= 1e18) return (num / 1e18).toFixed(1) + 'Qi';\r\n    if (num >= 1e15) return (num / 1e15).toFixed(1) + 'Q';\r\n    if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';\r\n    if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';\r\n    if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';\r\n    if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';\r\n    return Math.floor(num).toString();\r\n}\r\n\r\n/** Format percentage */\r\nexport function formatPercent(value: number, decimals: number = 0): string {\r\n    return (value * 100).toFixed(decimals) + '%';\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// ELEMENT UPDATES\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Update text content of an element */\r\nexport function updateElement(elementId: string, value: string | number): void {\r\n    const el = document.getElementById(elementId);\r\n    if (el) {\r\n        el.innerText = typeof value === 'number' ? formatNumber(value) : value;\r\n    }\r\n}\r\n\r\n/** Update element visibility */\r\nexport function setElementVisible(elementId: string, visible: boolean, display: string = 'flex'): void {\r\n    const el = document.getElementById(elementId);\r\n    if (el) {\r\n        el.style.display = visible ? display : 'none';\r\n    }\r\n}\r\n\r\n/** Update element style */\r\nexport function setElementStyle(elementId: string, property: string, value: string): void {\r\n    const el = document.getElementById(elementId);\r\n    if (el) {\r\n        (el.style as any)[property] = value;\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// POPULATION DISPLAY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport interface PopulationData {\r\n    current: number;\r\n    cap: number;\r\n    isWanderMode: boolean;\r\n}\r\n\r\n/** Update population display */\r\nexport function updatePopulation(data: PopulationData): void {\r\n    const display = data.isWanderMode\r\n        ? formatNumber(data.current)\r\n        : `${formatNumber(data.current)}/${formatNumber(data.cap)}`;\r\n    \r\n    updateElement('v-pop', display);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// RESOURCE DISPLAYS\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport interface ResourceData {\r\n    food: number;\r\n    wood: number;\r\n    metal: number;\r\n    stone: number;\r\n    gold: number;\r\n    inventory?: {\r\n        food: number;\r\n        wood: number;\r\n        metal: number;\r\n        stone: number;\r\n        capacity: number;\r\n    };\r\n    pocket?: {\r\n        metal: number;\r\n        stone: number;\r\n    };\r\n}\r\n\r\n/** Update resource displays */\r\nexport function updateResources(data: ResourceData, isWanderMode: boolean): void {\r\n    if (isWanderMode && data.inventory) {\r\n        // Wander mode - show inventory\r\n        const invTotal = data.inventory.food + data.inventory.wood + \r\n                        data.inventory.metal + data.inventory.stone;\r\n        \r\n        updateElement('v-food', `${formatNumber(data.inventory.food)}/${formatNumber(data.inventory.capacity)}`);\r\n        updateElement('v-wood', formatNumber(data.inventory.wood));\r\n        \r\n        const wanderMetal = (data.inventory.metal || 0) + (data.pocket?.metal || 0);\r\n        const wanderStone = (data.inventory.stone || 0) + (data.pocket?.stone || 0);\r\n        \r\n        updateElement('v-metal', formatNumber(wanderMetal));\r\n        updateElement('v-stone', formatNumber(wanderStone));\r\n        updateElement('v-inventory', `${formatNumber(invTotal)}/${formatNumber(data.inventory.capacity)}`);\r\n        \r\n        setElementVisible('stat-inventory', true);\r\n        setElementVisible('stat-wood', true);\r\n        setElementVisible('stat-metal', true);\r\n        setElementVisible('stat-stone', true);\r\n    } else {\r\n        // City mode - show regular resources\r\n        updateElement('v-food', formatNumber(data.food));\r\n        updateElement('v-wood', formatNumber(data.wood));\r\n        \r\n        const totalMetal = data.metal + (data.pocket?.metal || 0);\r\n        const totalStone = data.stone + (data.pocket?.stone || 0);\r\n        \r\n        updateElement('v-metal', formatNumber(totalMetal));\r\n        updateElement('v-stone', formatNumber(totalStone));\r\n        \r\n        setElementVisible('stat-inventory', false);\r\n        setElementVisible('stat-wood', true);\r\n        setElementVisible('stat-metal', true);\r\n        setElementVisible('stat-stone', true);\r\n    }\r\n    \r\n    updateElement('v-res', formatNumber(data.gold));\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// WATER DISPLAY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport interface WaterData {\r\n    wellCount: number;\r\n    population: number;\r\n    capacityPerWell: number;\r\n}\r\n\r\n/** Update water capacity display */\r\nexport function updateWaterDisplay(data: WaterData): void {\r\n    const capacity = data.wellCount * data.capacityPerWell;\r\n    const used = Math.min(data.population, capacity);\r\n    const percent = capacity > 0 ? Math.round((used / capacity) * 100) : 0;\r\n    \r\n    let status: string;\r\n    if (capacity === 0) {\r\n        status = '⚠️ No wells!';\r\n    } else if (data.population > capacity) {\r\n        status = `🔴 OVER CAPACITY! (${data.population}/${capacity})`;\r\n    } else if (percent > 80) {\r\n        status = `🟡 ${percent}% capacity`;\r\n    } else {\r\n        status = `🟢 ${percent}% capacity`;\r\n    }\r\n    \r\n    updateElement('v-wat', status);\r\n}\r\n\r\n/** Update wells display */\r\nexport function updateWellsDisplay(wellCount: number, population: number, capacityPerWell: number = 100): void {\r\n    const wellsNeeded = Math.max(1, Math.ceil(population / capacityPerWell));\r\n    const capacityUsed = wellCount > 0 ? Math.round((population / (wellCount * capacityPerWell)) * 100) : 0;\r\n    \r\n    let status: string;\r\n    if (wellCount >= wellsNeeded) {\r\n        status = `🟢 ${wellCount} wells (${capacityUsed}% capacity)`;\r\n    } else if (wellCount > 0) {\r\n        const shortage = wellsNeeded - wellCount;\r\n        status = `🔴 ${wellCount} wells (${shortage} more needed!)`;\r\n    } else {\r\n        status = '⚠️ No wells built!';\r\n    }\r\n    \r\n    updateElement('v-wells', status);\r\n    setElementVisible('stat-wells', true);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// THIRST DISPLAY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Update thirst indicator */\r\nexport function updateThirst(thirst: number, show: boolean = true): void {\r\n    setElementVisible('stat-thirst', show);\r\n    \r\n    if (!show) return;\r\n    \r\n    const thirstEl = document.getElementById('v-thirst');\r\n    if (thirstEl) {\r\n        thirstEl.innerText = thirst.toString();\r\n        \r\n        // Color code thirst level\r\n        if (thirst > 50) {\r\n            thirstEl.style.color = '#29B6F6'; // Blue - good\r\n        } else if (thirst > 25) {\r\n            thirstEl.style.color = '#FFA726'; // Orange - warning\r\n        } else {\r\n            thirstEl.style.color = '#E53935'; // Red - critical\r\n        }\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// NEEDS WARNING PANEL\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nexport interface NeedsData {\r\n    housing: { satisfied: number; shortage: number };\r\n    water: { satisfied: number; shortage: number };\r\n    food: { satisfied: number; shortage?: number };\r\n    jobs: { satisfied: number; shortage: number };\r\n    paths: { satisfied: number; shortage: number };\r\n    overall: number;\r\n}\r\n\r\n/** Generate need warnings from needs data */\r\nexport function generateNeedWarnings(needs: NeedsData, population: number): NeedWarning[] {\r\n    const warnings: NeedWarning[] = [];\r\n    \r\n    // Housing warnings\r\n    if (needs.housing.satisfied < 0.5) {\r\n        warnings.push({\r\n            type: 'housing',\r\n            message: `🏠 Housing CRITICAL (${needs.housing.shortage} homeless)`,\r\n            severity: 'critical',\r\n            color: NEED_COLORS.housing\r\n        });\r\n    } else if (needs.housing.satisfied < 0.8) {\r\n        warnings.push({\r\n            type: 'housing',\r\n            message: `🏠 Housing needed (${needs.housing.shortage} shortage)`,\r\n            severity: 'warning',\r\n            color: NEED_COLORS.housing\r\n        });\r\n    }\r\n    \r\n    // Water warnings\r\n    if (needs.water.satisfied < 0.5 && population >= 10) {\r\n        warnings.push({\r\n            type: 'water',\r\n            message: `💧 Water CRITICAL (need ${needs.water.shortage} wells)`,\r\n            severity: 'critical',\r\n            color: NEED_COLORS.water\r\n        });\r\n    } else if (needs.water.satisfied < 0.8 && population >= 10) {\r\n        warnings.push({\r\n            type: 'water',\r\n            message: `💧 Water needed (${needs.water.shortage} wells)`,\r\n            severity: 'warning',\r\n            color: NEED_COLORS.water\r\n        });\r\n    }\r\n    \r\n    // Food warnings\r\n    if (needs.food.satisfied < 0.3) {\r\n        warnings.push({\r\n            type: 'food',\r\n            message: '🌾 Food CRITICAL - reserves low!',\r\n            severity: 'critical',\r\n            color: NEED_COLORS.food\r\n        });\r\n    } else if (needs.food.satisfied < 0.6) {\r\n        warnings.push({\r\n            type: 'food',\r\n            message: '🌾 Food low - build industry',\r\n            severity: 'warning',\r\n            color: NEED_COLORS.food\r\n        });\r\n    }\r\n    \r\n    // Jobs warnings\r\n    if (needs.jobs.satisfied < 0.7 && population > 20) {\r\n        warnings.push({\r\n            type: 'jobs',\r\n            message: `💼 Jobs needed (${needs.jobs.shortage} unemployed)`,\r\n            severity: 'warning',\r\n            color: NEED_COLORS.jobs\r\n        });\r\n    }\r\n    \r\n    // Paths warnings\r\n    if (needs.paths.satisfied < 0.5) {\r\n        warnings.push({\r\n            type: 'paths',\r\n            message: `🛤️ Paths needed (${needs.paths.shortage} tiles)`,\r\n            severity: 'warning',\r\n            color: NEED_COLORS.paths\r\n        });\r\n    }\r\n    \r\n    return warnings;\r\n}\r\n\r\n/** Update needs warning panel */\r\nexport function updateNeedsPanel(needs: NeedsData, population: number, isSimcityMode: boolean): void {\r\n    const panel = document.getElementById('needs-warning-panel');\r\n    const needsList = document.getElementById('needs-list');\r\n    const satisfactionBar = document.getElementById('satisfaction-bar');\r\n    \r\n    // Only show in SimCity mode with reasonable population\r\n    if (!isSimcityMode || population < 5) {\r\n        if (panel) panel.style.display = 'none';\r\n        return;\r\n    }\r\n    \r\n    const warnings = generateNeedWarnings(needs, population);\r\n    \r\n    if (needsList) {\r\n        if (warnings.length === 0) {\r\n            needsList.innerHTML = '<span style=\"color: #6BCF7F;\">✓ All needs met!</span>';\r\n            if (panel) {\r\n                panel.style.border = '2px solid #6BCF7F';\r\n                panel.style.boxShadow = '0 8px 25px rgba(107,207,127,0.3)';\r\n            }\r\n        } else {\r\n            needsList.innerHTML = warnings.map(w => `<div>• ${w.message}</div>`).join('');\r\n            if (panel) {\r\n                panel.style.border = '2px solid #FF6B6B';\r\n                panel.style.boxShadow = '0 8px 25px rgba(255,107,107,0.3)';\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Update satisfaction bar\r\n    if (satisfactionBar) {\r\n        const satisfaction = needs.overall || 1.0;\r\n        const satPercent = Math.floor(satisfaction * 100);\r\n        \r\n        satisfactionBar.style.width = (satisfaction * 100) + '%';\r\n        satisfactionBar.textContent = satPercent + '%';\r\n        \r\n        if (satisfaction >= 0.8) {\r\n            satisfactionBar.style.background = 'linear-gradient(90deg, #6BCF7F 0%, #4CAF50 100%)';\r\n        } else if (satisfaction >= 0.5) {\r\n            satisfactionBar.style.background = 'linear-gradient(90deg, #FFD93D 0%, #FFA726 100%)';\r\n        } else {\r\n            satisfactionBar.style.background = 'linear-gradient(90deg, #FF6B6B 0%, #C62828 100%)';\r\n        }\r\n    }\r\n    \r\n    if (panel) panel.style.display = 'block';\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// BUTTON STATE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Enable/disable a button */\r\nexport function setButtonEnabled(buttonId: string, enabled: boolean, title?: string): void {\r\n    const btn = document.getElementById(buttonId) as HTMLButtonElement;\r\n    if (btn) {\r\n        btn.disabled = !enabled;\r\n        if (title) btn.title = title;\r\n    }\r\n}\r\n\r\n/** Set button active state */\r\nexport function setButtonActive(buttonId: string, active: boolean): void {\r\n    const btn = document.getElementById(buttonId);\r\n    if (btn) {\r\n        if (active) {\r\n            btn.classList.add('active');\r\n        } else {\r\n            btn.classList.remove('active');\r\n        }\r\n    }\r\n}\r\n\r\n/** Clear all button active states */\r\nexport function clearAllButtonActive(selector: string = '.btn'): void {\r\n    document.querySelectorAll(selector).forEach(btn => {\r\n        btn.classList.remove('active');\r\n    });\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// HUD MODE SWITCHING\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Configure HUD for Wander mode */\r\nexport function setWanderMode(): void {\r\n    hudState.showThirst = true;\r\n    hudState.showInventory = true;\r\n    hudState.showYear = false;\r\n    \r\n    setElementVisible('stat-thirst', true);\r\n    setElementVisible('stat-inventory', true);\r\n    setElementVisible('stat-wander-wells', true);\r\n    setElementVisible('stat-year', false);\r\n    setElementVisible('stat-water', false);\r\n    setElementVisible('stat-funds', false);\r\n    setElementVisible('btn-settle', true, 'inline-block');\r\n}\r\n\r\n/** Configure HUD for City mode */\r\nexport function setCityMode(): void {\r\n    hudState.showThirst = false;\r\n    hudState.showInventory = false;\r\n    hudState.showYear = true;\r\n    \r\n    setElementVisible('stat-thirst', false);\r\n    setElementVisible('stat-inventory', false);\r\n    setElementVisible('stat-wander-wells', false);\r\n    setElementVisible('stat-year', true);\r\n    setElementVisible('stat-water', true);\r\n    setElementVisible('stat-funds', true);\r\n    setElementVisible('btn-settle', false);\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// UTILITY\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Get HUD state */\r\nexport function getHUDState(): HUDState {\r\n    return { ...hudState };\r\n}\r\n\r\n/** Update HUD state */\r\nexport function updateHUDState(updates: Partial<HUDState>): void {\r\n    Object.assign(hudState, updates);\r\n}\r\n","/**\r\n * Civil Zones - Logging System\r\n * Captures console logs and provides player/technical log views\r\n */\r\n\r\nimport type { LogLevel, LogEntry, LogViewType, LogState } from './types.js';\r\nimport { MAX_PLAYER_LOG_ENTRIES, MAX_TECHNICAL_LOG_ENTRIES } from './types.js';\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG STATE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\nlet logState: LogState = {\r\n    playerLog: [],\r\n    technicalLog: [],\r\n    currentView: 'player',\r\n    maxEntries: MAX_TECHNICAL_LOG_ENTRIES\r\n};\r\n\r\n// Original console methods (preserved for chaining)\r\nlet originalConsole: {\r\n    log: typeof console.log;\r\n    error: typeof console.error;\r\n    warn: typeof console.warn;\r\n    info: typeof console.info;\r\n} | null = null;\r\n\r\n// Callback for toast display on errors\r\nlet errorToastCallback: ((message: string) => void) | null = null;\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG CAPTURE\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Initialize console log capture */\r\nexport function initLogCapture(onErrorToast?: (message: string) => void): void {\r\n    if (originalConsole) return; // Already initialized\r\n    \r\n    errorToastCallback = onErrorToast || null;\r\n    \r\n    // Store original methods\r\n    originalConsole = {\r\n        log: console.log.bind(console),\r\n        error: console.error.bind(console),\r\n        warn: console.warn.bind(console),\r\n        info: console.info.bind(console)\r\n    };\r\n    \r\n    // Override console.log\r\n    console.log = function(...args: any[]) {\r\n        originalConsole!.log(...args);\r\n        addTechnicalEntry('LOG', formatLogArgs(args));\r\n    };\r\n    \r\n    // Override console.error\r\n    console.error = function(...args: any[]) {\r\n        originalConsole!.error(...args);\r\n        const msg = formatLogArgs(args);\r\n        addTechnicalEntry('ERROR', msg);\r\n        \r\n        // Auto-toast errors\r\n        if (errorToastCallback) {\r\n            const shortMsg = msg.length > 80 ? msg.substring(0, 80) + '...' : msg;\r\n            errorToastCallback(`⚠️ ERROR: ${shortMsg}`);\r\n        }\r\n    };\r\n    \r\n    // Override console.warn\r\n    console.warn = function(...args: any[]) {\r\n        originalConsole!.warn(...args);\r\n        addTechnicalEntry('WARN', formatLogArgs(args));\r\n    };\r\n    \r\n    // Override console.info\r\n    console.info = function(...args: any[]) {\r\n        originalConsole!.info(...args);\r\n        addTechnicalEntry('INFO', formatLogArgs(args));\r\n    };\r\n}\r\n\r\n/** Restore original console methods */\r\nexport function restoreConsole(): void {\r\n    if (!originalConsole) return;\r\n    \r\n    console.log = originalConsole.log;\r\n    console.error = originalConsole.error;\r\n    console.warn = originalConsole.warn;\r\n    console.info = originalConsole.info;\r\n    \r\n    originalConsole = null;\r\n}\r\n\r\n/** Format log arguments to string */\r\nfunction formatLogArgs(args: any[]): string {\r\n    return args.map(a => {\r\n        if (typeof a === 'object') {\r\n            try {\r\n                return JSON.stringify(a);\r\n            } catch {\r\n                return String(a);\r\n            }\r\n        }\r\n        return String(a);\r\n    }).join(' ');\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG ENTRIES\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Add entry to player log */\r\nexport function addPlayerEntry(message: string, year: number = 0): void {\r\n    const entry: LogEntry = {\r\n        timestamp: `[Y${year}]`,\r\n        level: 'INFO',\r\n        message\r\n    };\r\n    \r\n    logState.playerLog.push(entry);\r\n    \r\n    // Trim if too long\r\n    while (logState.playerLog.length > MAX_PLAYER_LOG_ENTRIES) {\r\n        logState.playerLog.shift();\r\n    }\r\n}\r\n\r\n/** Add entry to technical log */\r\nexport function addTechnicalEntry(level: LogLevel, message: string): void {\r\n    const entry: LogEntry = {\r\n        timestamp: new Date().toLocaleTimeString(),\r\n        level,\r\n        message\r\n    };\r\n    \r\n    logState.technicalLog.push(entry);\r\n    \r\n    // Trim if too long\r\n    while (logState.technicalLog.length > MAX_TECHNICAL_LOG_ENTRIES) {\r\n        logState.technicalLog.shift();\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG RETRIEVAL\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Get player log entries as strings */\r\nexport function getPlayerLog(): string[] {\r\n    return logState.playerLog.map(e => `${e.timestamp} ${e.message}`);\r\n}\r\n\r\n/** Get technical log entries as strings */\r\nexport function getTechnicalLog(): string[] {\r\n    return logState.technicalLog.map(e => `[${e.timestamp}] [${e.level}] ${e.message}`);\r\n}\r\n\r\n/** Get raw log entries */\r\nexport function getLogEntries(type: LogViewType): LogEntry[] {\r\n    return type === 'player' ? [...logState.playerLog] : [...logState.technicalLog];\r\n}\r\n\r\n/** Get current log view type */\r\nexport function getCurrentLogView(): LogViewType {\r\n    return logState.currentView;\r\n}\r\n\r\n/** Set current log view type */\r\nexport function setCurrentLogView(view: LogViewType): void {\r\n    logState.currentView = view;\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG MODAL UI\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Update log modal display */\r\nexport function updateLogDisplay(contentElementId: string = 'log-content'): void {\r\n    const content = document.getElementById(contentElementId);\r\n    if (!content) return;\r\n    \r\n    const logs = logState.currentView === 'player' \r\n        ? getPlayerLog() \r\n        : getTechnicalLog();\r\n    \r\n    if (logs.length === 0) {\r\n        content.innerText = logState.currentView === 'player'\r\n            ? 'No player events logged yet.'\r\n            : 'No technical events logged yet.';\r\n    } else {\r\n        content.innerText = logs.join('\\n');\r\n    }\r\n    \r\n    // Auto-scroll to bottom\r\n    content.scrollTop = content.scrollHeight;\r\n}\r\n\r\n/** Switch log view and update UI */\r\nexport function switchLogView(\r\n    view: LogViewType,\r\n    playerBtnId: string = 'btn-player-log',\r\n    techBtnId: string = 'btn-technical-log'\r\n): void {\r\n    setCurrentLogView(view);\r\n    \r\n    const playerBtn = document.getElementById(playerBtnId);\r\n    const techBtn = document.getElementById(techBtnId);\r\n    \r\n    if (view === 'player') {\r\n        if (playerBtn) {\r\n            playerBtn.style.background = '#4CAF50';\r\n            playerBtn.style.fontWeight = 'bold';\r\n        }\r\n        if (techBtn) {\r\n            techBtn.style.background = '#333';\r\n            techBtn.style.fontWeight = 'normal';\r\n        }\r\n    } else {\r\n        if (playerBtn) {\r\n            playerBtn.style.background = '#333';\r\n            playerBtn.style.fontWeight = 'normal';\r\n        }\r\n        if (techBtn) {\r\n            techBtn.style.background = '#4CAF50';\r\n            techBtn.style.fontWeight = 'bold';\r\n        }\r\n    }\r\n    \r\n    updateLogDisplay();\r\n}\r\n\r\n/** Show log modal */\r\nexport function showLogModal(modalId: string = 'log-modal'): void {\r\n    updateLogDisplay();\r\n    const modal = document.getElementById(modalId);\r\n    if (modal) {\r\n        modal.style.display = 'flex';\r\n    }\r\n}\r\n\r\n/** Hide log modal */\r\nexport function hideLogModal(modalId: string = 'log-modal'): void {\r\n    const modal = document.getElementById(modalId);\r\n    if (modal) {\r\n        modal.style.display = 'none';\r\n    }\r\n}\r\n\r\n/** Copy log to clipboard */\r\nexport async function copyLogToClipboard(\r\n    contentElementId: string = 'log-content',\r\n    onSuccess?: () => void,\r\n    onError?: () => void\r\n): Promise<boolean> {\r\n    const content = document.getElementById(contentElementId);\r\n    if (!content) return false;\r\n    \r\n    const text = content.innerText;\r\n    \r\n    try {\r\n        await navigator.clipboard.writeText(text);\r\n        onSuccess?.();\r\n        return true;\r\n    } catch {\r\n        // Fallback for older browsers\r\n        const textarea = document.createElement('textarea');\r\n        textarea.value = text;\r\n        textarea.style.position = 'fixed';\r\n        textarea.style.opacity = '0';\r\n        document.body.appendChild(textarea);\r\n        textarea.select();\r\n        \r\n        try {\r\n            document.execCommand('copy');\r\n            onSuccess?.();\r\n            document.body.removeChild(textarea);\r\n            return true;\r\n        } catch {\r\n            onError?.();\r\n            document.body.removeChild(textarea);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════════\r\n// LOG MANAGEMENT\r\n// ═══════════════════════════════════════════════════════════════════\r\n\r\n/** Clear all logs */\r\nexport function clearLogs(): void {\r\n    logState.playerLog = [];\r\n    logState.technicalLog = [];\r\n}\r\n\r\n/** Set logs from external source (for save/load) */\r\nexport function setLogs(playerLog: string[], technicalLog: string[]): void {\r\n    logState.playerLog = playerLog.map(msg => ({\r\n        timestamp: '',\r\n        level: 'INFO' as LogLevel,\r\n        message: msg\r\n    }));\r\n    logState.technicalLog = technicalLog.map(msg => ({\r\n        timestamp: '',\r\n        level: 'INFO' as LogLevel,\r\n        message: msg\r\n    }));\r\n}\r\n\r\n/** Get log state */\r\nexport function getLogState(): LogState {\r\n    return { ...logState };\r\n}\r\n"],"names":["TERRAIN_COLORS","BUILDING_COLORS","MAP_COLORS","UI_COLORS","ZONE_COLORS","getDesirabilityColor","desirability","alpha","r","g","b","getElevationOverlayColor","tileType","elevation","seaLevel","diff","generateLevelColors","level","hueBase","saturation","lightness","PARTICLE_COLORS","CHARACTER_COLORS","BERRY_COLORS","ALL_COLORS","roundRectPath","ctx","x","y","w","h","radius","fillRoundRect","strokeRoundRect","drawRoundRect","fillStyle","strokeStyle","drawCircle","drawEllipse","radiusX","radiusY","rotation","drawLine","x1","y1","x2","y2","lineWidth","drawPolygon","points","drawQuadraticCurve","cpX","cpY","drawBezierCurve","cp1X","cp1Y","cp2X","cp2Y","drawText","text","options","font","align","baseline","shadow","drawTextWithOutline","createSphereGradient","lightColor","midColor","darkColor","gradient","createLinearGradient","stops","stop","withRotation","angle","draw","withScale","scaleX","scaleY","withAlpha","prevAlpha","withClip","withCircularClip","drawStipple","width","height","density","color","dotSize","count","i","dx","dy","drawHatching","spacing","cos","sin","diagonal","d","startX","startY","endX","endY","DEFAULT_CAMERA_CONFIG","createCamera","zoom","createCenteredCamera","mapWidth","mapHeight","tileSize","screenToWorld","screenX","screenY","camera","viewport","worldX","worldY","worldToScreen","screenToTile","world","tileToScreen","tileX","tileY","getVisibleTileRange","halfWidth","halfHeight","startCol","endCol","startRow","endRow","isTileVisible","tileLeft","tileRight","tileTop","tileBottom","viewLeft","viewRight","viewTop","viewBottom","panCamera","deltaX","deltaY","centerCameraOn","centerCameraOnTile","zoomCamera","delta","config","newZoom","zoomCameraAt","worldBefore","tempCamera","worldAfter","clampCameraToMap","worldWidth","worldHeight","halfViewWidth","halfViewHeight","applyCameraTransform","restoreCameraTransform","ParticlePool","initialSize","maxSize","vx","vy","life","size","p","oldest","deltaTime","gravity","EffectManager","type","duration","data","chips","speed","puffs","now","e","effect","elapsed","getWoodChipPosition","chip","progress","distance","getDustPuffSize","puff","expand","currentRadius","getImpactStarPositions","stars","VIEW_MODES","NEED_COLORS","DEFAULT_TOAST_DURATION","MAX_PLAYER_LOG_ENTRIES","MAX_TECHNICAL_LOG_ENTRIES","toastState","toastElement","initToast","elementId","showToast","message","isError","persistent","addToTechnicalLog","hideToast","showError","showSuccess","showWarning","ToastManager","year","playerTimestamp","techTimestamp","menuState","showMenu","menuId","panel","hideMenu","hideAllMenus","menuIds","toggleMenu","isMenuOpen","setSelectedLevel","getSelectedLevel","updateCardSelection","gridSelector","selectedCardId","card","selectedCard","showOverlay","overlayId","overlay","hideOverlay","showModal","modalId","title","content","modal","titleEl","contentEl","hideModal","generateStatsHTML","stats","html","formatNumber","num","updateElement","value","el","setElementVisible","visible","display","updatePopulation","updateResources","isWanderMode","invTotal","wanderMetal","wanderStone","totalMetal","totalStone","updateWaterDisplay","capacity","used","percent","status","updateWellsDisplay","wellCount","population","capacityPerWell","wellsNeeded","capacityUsed","shortage","updateThirst","thirst","show","thirstEl","generateNeedWarnings","needs","warnings","updateNeedsPanel","isSimcityMode","needsList","satisfactionBar","satisfaction","satPercent","setWanderMode","setCityMode","logState","originalConsole","errorToastCallback","initLogCapture","onErrorToast","args","addTechnicalEntry","formatLogArgs","msg","shortMsg","restoreConsole","a","addPlayerEntry","entry","getPlayerLog","getTechnicalLog","getLogEntries","getCurrentLogView","setCurrentLogView","view","updateLogDisplay","contentElementId","logs","switchLogView","playerBtnId","techBtnId","playerBtn","techBtn","showLogModal","hideLogModal","copyLogToClipboard","onSuccess","onError","textarea","clearLogs","setLogs","playerLog","technicalLog","getLogState"],"mappings":"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"}