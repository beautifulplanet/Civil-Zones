<!DOCTYPE html>
<html>
<head>
    <title>Civil Zones - TypeScript Module Test</title>
    <style>
        body { font-family: monospace; background: #1a1a2e; color: #0f0; padding: 20px; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .info { color: #0ff; }
        h1 { color: #fff; }
        pre { background: #0a0a1a; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ—ï¸ Civil Zones TypeScript Module Test</h1>
    <pre id="output">Loading modules...</pre>
    
    <script type="module">
        const output = document.getElementById('output');
        let results = [];
        
        function log(msg, type = 'info') {
            results.push(`<span class="${type}">${msg}</span>`);
            output.innerHTML = results.join('\n');
        }
        
        async function runTests() {
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('  CIVIL ZONES - TypeScript Module System Test');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('');
            
            let passCount = 0;
            let failCount = 0;
            
            function check(name, condition, value = '') {
                if (condition) {
                    log(`âœ… ${name}${value ? ' = ' + value : ''}`, 'pass');
                    passCount++;
                    return true;
                } else {
                    log(`âŒ ${name} - NOT FOUND`, 'fail');
                    failCount++;
                    return false;
                }
            }
            
            try {
                // Import all modules from main entry point
                const CZ = await import('./dist/index.js');
                log('âœ… Main index.js loaded successfully', 'pass');
                passCount++;
                log('');
                
                // Test VERSION export
                log(`ğŸ“¦ Version: ${CZ.VERSION}`, 'info');
                log(`ğŸ“… Build Date: ${CZ.BUILD_DATE}`, 'info');
                log(`ğŸ“ Module Count: ${CZ.MODULE_COUNT}`, 'info');
                log('');
                
                // Test Constants
                log('â”€â”€â”€ CONFIG/CONSTANTS â”€â”€â”€', 'info');
                check('MAP_CONFIG', CZ.MAP_CONFIG, `{ TILE: ${CZ.MAP_CONFIG?.TILE}, W: ${CZ.MAP_CONFIG?.W}, H: ${CZ.MAP_CONFIG?.H} }`);
                check('INVENTORY', CZ.INVENTORY, `BACKPACK_BASE: ${CZ.INVENTORY?.BACKPACK_BASE}`);
                check('ZONE_COST', CZ.ZONE_COST !== undefined, CZ.ZONE_COST);
                check('GROWTH_THRESHOLD', CZ.GROWTH_THRESHOLD !== undefined, CZ.GROWTH_THRESHOLD);
                check('ERAS', CZ.ERAS, `${CZ.ERAS?.length} eras defined`);
                log('');
                
                // Test Building Database
                log('â”€â”€â”€ CONFIG/BUILDING DATABASE â”€â”€â”€', 'info');
                check('RESIDENTIAL_BUILDINGS', CZ.RESIDENTIAL_BUILDINGS, `${Object.keys(CZ.RESIDENTIAL_BUILDINGS || {}).length} types`);
                check('COMMERCIAL_BUILDINGS', CZ.COMMERCIAL_BUILDINGS, `${Object.keys(CZ.COMMERCIAL_BUILDINGS || {}).length} types`);
                check('INDUSTRIAL_BUILDINGS', CZ.INDUSTRIAL_BUILDINGS, `${Object.keys(CZ.INDUSTRIAL_BUILDINGS || {}).length} types`);
                check('SPECIAL_BUILDINGS', CZ.SPECIAL_BUILDINGS, `${Object.keys(CZ.SPECIAL_BUILDINGS || {}).length} types`);
                check('BUILDING_DB', CZ.BUILDING_DB, `${Object.keys(CZ.BUILDING_DB || {}).length} total buildings`);
                check('getBuilding()', typeof CZ.getBuilding === 'function');
                log('');
                
                // Test Core Utils
                log('â”€â”€â”€ CORE/UTILS â”€â”€â”€', 'info');
                if (check('clamp()', typeof CZ.clamp === 'function')) {
                    const result = CZ.clamp(150, 0, 100);
                    log(`   â†’ clamp(150, 0, 100) = ${result}`, 'info');
                }
                if (check('lerp()', typeof CZ.lerp === 'function')) {
                    const result = CZ.lerp(0, 100, 0.5);
                    log(`   â†’ lerp(0, 100, 0.5) = ${result}`, 'info');
                }
                check('randomInRange()', typeof CZ.randomInRange === 'function');
                check('formatNumber()', typeof CZ.formatNumber === 'function');
                check('distance()', typeof CZ.distance === 'function');
                log('');
                
                // Test Noise Generator
                log('â”€â”€â”€ CORE/NOISE â”€â”€â”€', 'info');
                if (check('createNoiseGenerator()', typeof CZ.createNoiseGenerator === 'function')) {
                    const noise = CZ.createNoiseGenerator(12345);
                    const value = noise.get(10, 20);
                    log(`   â†’ noise.get(10, 20) = ${value.toFixed(4)}`, 'info');
                }
                log('');
                
                // Test Color System
                log('â”€â”€â”€ RENDERING/COLORS â”€â”€â”€', 'info');
                check('TERRAIN_COLORS', CZ.TERRAIN_COLORS, `${Object.keys(CZ.TERRAIN_COLORS || {}).length} colors`);
                check('ZONE_COLORS', CZ.ZONE_COLORS);
                if (check('hexToRgb()', typeof CZ.hexToRgb === 'function')) {
                    const rgb = CZ.hexToRgb('#ff0000');
                    log(`   â†’ hexToRgb('#ff0000') = rgb(${rgb?.r}, ${rgb?.g}, ${rgb?.b})`, 'info');
                }
                log('');
                
                // Test Time System
                log('â”€â”€â”€ TIME/TURNS â”€â”€â”€', 'info');
                if (check('createTimeState()', typeof CZ.createTimeState === 'function')) {
                    const time = CZ.createTimeState();
                    log(`   â†’ Initial year: ${time.year}`, 'info');
                }
                check('advanceYear()', typeof CZ.advanceYear === 'function');
                check('formatYear()', typeof CZ.formatYear === 'function');
                log('');
                
                // Test Spoilage System
                log('â”€â”€â”€ TIME/SPOILAGE â”€â”€â”€', 'info');
                check('DEFAULT_SPOILAGE_RATES', CZ.DEFAULT_SPOILAGE_RATES, 
                    `food: ${(CZ.DEFAULT_SPOILAGE_RATES?.food * 100)}%, wood: ${(CZ.DEFAULT_SPOILAGE_RATES?.wood * 100)}%`);
                check('calculateSpoilage()', typeof CZ.calculateSpoilage === 'function');
                check('processAllSpoilage()', typeof CZ.processAllSpoilage === 'function');
                log('');
                
                // Test Population System
                log('â”€â”€â”€ SYSTEMS/POPULATION â”€â”€â”€', 'info');
                check('calculateGrowth()', typeof CZ.calculateGrowth === 'function');
                check('calculateStarvation()', typeof CZ.calculateStarvation === 'function');
                check('calculateDehydration()', typeof CZ.calculateDehydration === 'function');
                check('calculatePlague()', typeof CZ.calculatePlague === 'function');
                log('');
                
                // Test AI System
                log('â”€â”€â”€ AI/QLEARNING â”€â”€â”€', 'info');
                check('createQTable()', typeof CZ.createQTable === 'function');
                check('chooseAction()', typeof CZ.chooseAction === 'function');
                check('updateQValue()', typeof CZ.updateQValue === 'function');
                log('');
                
                // Test Building System
                log('â”€â”€â”€ BUILDINGS â”€â”€â”€', 'info');
                check('canPlaceBuilding()', typeof CZ.canPlaceBuilding === 'function');
                check('validatePlacement()', typeof CZ.validatePlacement === 'function');
                check('calculateEvolutionProgress()', typeof CZ.calculateEvolutionProgress === 'function');
                log('');
                
                // Test Entity System
                log('â”€â”€â”€ ENTITIES â”€â”€â”€', 'info');
                check('createAnimalSpawner()', typeof CZ.createAnimalSpawner === 'function');
                check('calculateDamage()', typeof CZ.calculateDamage === 'function');
                check('shouldNomadsArrive()', typeof CZ.shouldNomadsArrive === 'function');
                log('');
                
                // Test Events System
                log('â”€â”€â”€ EVENTS â”€â”€â”€', 'info');
                check('createFloodState()', typeof CZ.createFloodState === 'function');
                check('generateLoreEvent()', typeof CZ.generateLoreEvent === 'function');
                check('LORE_TEMPLATES', CZ.LORE_TEMPLATES);
                log('');
                
                // Test World Generation
                log('â”€â”€â”€ WORLD â”€â”€â”€', 'info');
                check('DEFAULT_TERRAIN_CONFIG', CZ.DEFAULT_TERRAIN_CONFIG);
                check('generateHeightMap()', typeof CZ.generateHeightMap === 'function');
                check('findSpawnLocation()', typeof CZ.findSpawnLocation === 'function');
                log('');
                
                // Summary
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                if (failCount === 0) {
                    log(`  âœ… ALL ${passCount} TESTS PASSED!`, 'pass');
                } else {
                    log(`  âš ï¸ ${passCount} passed, ${failCount} failed`, failCount > 0 ? 'fail' : 'pass');
                }
                log('  ğŸ“Š 76 TypeScript files compiled to JavaScript', 'info');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                
            } catch (error) {
                log(`âŒ ERROR: ${error.message}`, 'fail');
                log(error.stack, 'fail');
            }
        }
        
        runTests();
    </script>
</body>
</html>
